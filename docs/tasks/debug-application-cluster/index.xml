<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>ğŸ˜ - ç›‘æ§ã€æ—¥å¿—å’Œæ’é”™ on Hugo ä¸»é¢˜çš„ Learn æ–‡æ¡£</title>
    <link>https://lijun.in/tasks/debug-application-cluster/</link>
    <description>Recent content in ğŸ˜ - ç›‘æ§ã€æ—¥å¿—å’Œæ’é”™ on Hugo ä¸»é¢˜çš„ Learn æ–‡æ¡£</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-US</language>
    
	<atom:link href="https://lijun.in/tasks/debug-application-cluster/index.xml" rel="self" type="application/rss+xml" />
    
    
    <item>
      <title>Auditing</title>
      <link>https://lijun.in/tasks/debug-application-cluster/audit/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://lijun.in/tasks/debug-application-cluster/audit/</guid>
      <description>. feature-state state=&amp;quot;beta&amp;rdquo; &amp;gt;}}
Kubernetes å®¡è®¡åŠŸèƒ½æä¾›äº†ä¸å®‰å…¨ç›¸å…³çš„æŒ‰æ—¶é—´é¡ºåºæ’åˆ—çš„è®°å½•é›†ï¼Œè®°å½•å•ä¸ªç”¨æˆ·ã€ç®¡ç†å‘˜æˆ–ç³»ç»Ÿå…¶ä»–ç»„ä»¶å½±å“ç³»ç»Ÿçš„æ´»åŠ¨é¡ºåºã€‚ å®ƒèƒ½å¸®åŠ©é›†ç¾¤ç®¡ç†å‘˜å¤„ç†ä»¥ä¸‹é—®é¢˜ï¼š
 å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ ä»€ä¹ˆæ—¶å€™å‘ç”Ÿçš„ï¼Ÿ è°è§¦å‘çš„ï¼Ÿ æ´»åŠ¨å‘ç”Ÿåœ¨å“ªä¸ªï¼ˆäº›ï¼‰å¯¹è±¡ä¸Šï¼Ÿ åœ¨å“ªè§‚å¯Ÿåˆ°çš„ï¼Ÿ å®ƒä»å“ªè§¦å‘çš„ï¼Ÿ æ´»åŠ¨çš„åç»­å¤„ç†è¡Œä¸ºæ˜¯ä»€ä¹ˆï¼Ÿ  . toc &amp;gt;}}
Kube-apiserver æ‰§è¡Œå®¡è®¡ã€‚æ¯ä¸ªæ‰§è¡Œé˜¶æ®µçš„æ¯ä¸ªè¯·æ±‚éƒ½ä¼šç”Ÿæˆä¸€ä¸ªäº‹ä»¶ï¼Œç„¶åæ ¹æ®ç‰¹å®šç­–ç•¥å¯¹äº‹ä»¶è¿›è¡Œé¢„å¤„ç†å¹¶å†™å…¥åç«¯ã€‚ æ‚¨å¯ä»¥åœ¨ è®¾è®¡æ–¹æ¡ˆ ä¸­æ‰¾åˆ°æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚ è¯¥ç­–ç•¥ç¡®å®šè®°å½•çš„å†…å®¹å¹¶ä¸”åœ¨åç«¯å­˜å‚¨è®°å½•ã€‚å½“å‰çš„åç«¯æ”¯æŒæ—¥å¿—æ–‡ä»¶å’Œ webhookã€‚
æ¯ä¸ªè¯·æ±‚éƒ½å¯ä»¥ç”¨ç›¸å…³çš„ &amp;ldquo;stage&amp;rdquo; è®°å½•ã€‚å·²çŸ¥çš„ stage æœ‰ï¼š
  RequestReceived - äº‹ä»¶çš„ stage å°†åœ¨å®¡è®¡å¤„ç†å™¨æ¥æ”¶åˆ°è¯·æ±‚åï¼Œå¹¶ä¸”åœ¨å§”æ‰˜ç»™å…¶ä½™å¤„ç†å™¨ä¹‹å‰ç”Ÿæˆã€‚
  ResponseStarted - åœ¨å“åº”æ¶ˆæ¯çš„å¤´éƒ¨å‘é€åï¼Œä½†æ˜¯å“åº”æ¶ˆæ¯ä½“å‘é€å‰ã€‚è¿™ä¸ª stage ä»…ä¸ºé•¿æ—¶é—´è¿è¡Œçš„è¯·æ±‚ç”Ÿæˆï¼ˆä¾‹å¦‚ watchï¼‰ã€‚
  ResponseComplete - å½“å“åº”æ¶ˆæ¯ä½“å®Œæˆå¹¶ä¸”æ²¡æœ‰æ›´å¤šæ•°æ®éœ€è¦ä¼ è¾“çš„æ—¶å€™ã€‚
  Panic - å½“ panic å‘ç”Ÿæ—¶ç”Ÿæˆã€‚
  . note &amp;gt;}}
æ³¨æ„ å®¡è®¡æ—¥å¿—è®°å½•åŠŸèƒ½ä¼šå¢åŠ  API server çš„å†…å­˜æ¶ˆè€—ï¼Œå› ä¸ºéœ€è¦ä¸ºæ¯ä¸ªè¯·æ±‚å­˜å‚¨å®¡è®¡æ‰€éœ€çš„æŸäº›ä¸Šä¸‹æ–‡ã€‚ æ­¤å¤–ï¼Œå†…å­˜æ¶ˆè€—å–å†³äºå®¡è®¡æ—¥å¿—è®°å½•çš„é…ç½®ã€‚ . /note &amp;gt;}}</description>
    </item>
    
    <item>
      <title>StackDriver ä¸­çš„äº‹ä»¶</title>
      <link>https://lijun.in/tasks/debug-application-cluster/events-stackdriver/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://lijun.in/tasks/debug-application-cluster/events-stackdriver/</guid>
      <description>Kubernetes äº‹ä»¶æ˜¯ä¸€ç§å¯¹è±¡ï¼Œå®ƒä¸ºç”¨æˆ·æä¾›äº†æ´å¯Ÿé›†ç¾¤å†…å‘ç”Ÿçš„äº‹æƒ…çš„èƒ½åŠ›ï¼Œä¾‹å¦‚è°ƒåº¦ç¨‹åºåšå‡ºäº†ä»€ä¹ˆå†³å®šï¼Œæˆ–è€…ä¸ºä»€ä¹ˆæŸäº› Pod è¢«é€å‡ºèŠ‚ç‚¹ã€‚ æ‚¨å¯ä»¥åœ¨åº”ç”¨ç¨‹åºè‡ªæ£€å’Œè°ƒè¯•ä¸­é˜…è¯»æœ‰å…³ä½¿ç”¨äº‹ä»¶è°ƒè¯•åº”ç”¨ç¨‹åºçš„æ›´å¤šä¿¡æ¯ã€‚
å› ä¸ºäº‹ä»¶æ˜¯ API å¯¹è±¡ï¼Œæ‰€ä»¥å®ƒä»¬å­˜å‚¨åœ¨ä¸»èŠ‚ç‚¹ä¸Šçš„ apiserver ä¸­ã€‚ ä¸ºäº†é¿å…ä¸»èŠ‚ç‚¹ç£ç›˜ç©ºé—´è¢«å¡«æ»¡ï¼Œå°†å¼ºåˆ¶æ‰§è¡Œä¿ç•™ç­–ç•¥ï¼šäº‹ä»¶åœ¨æœ€åä¸€æ¬¡å‘ç”Ÿçš„ä¸€å°æ—¶åå°†ä¼šè¢«åˆ é™¤ã€‚ ä¸ºäº†æä¾›æ›´é•¿çš„å†å²è®°å½•å’Œèšåˆèƒ½åŠ›ï¼Œåº”è¯¥å®‰è£…ç¬¬ä¸‰æ–¹è§£å†³æ–¹æ¡ˆæ¥æ•è·äº‹ä»¶ã€‚
æœ¬æ–‡æè¿°äº†ä¸€ä¸ªå°† Kubernetes äº‹ä»¶å¯¼å‡ºä¸º Stackdriver Logging çš„è§£å†³æ–¹æ¡ˆï¼Œåœ¨è¿™é‡Œå¯ä»¥å¯¹å®ƒä»¬è¿›è¡Œå¤„ç†å’Œåˆ†æã€‚
. note &amp;gt;}}
ä¸èƒ½ä¿è¯é›†ç¾¤ä¸­å‘ç”Ÿçš„æ‰€æœ‰äº‹ä»¶éƒ½å°†å¯¼å‡ºåˆ° Stackdriverã€‚ äº‹ä»¶ä¸èƒ½å¯¼å‡ºçš„ä¸€ç§å¯èƒ½æƒ…å†µæ˜¯äº‹ä»¶å¯¼å‡ºå™¨æ²¡æœ‰è¿è¡Œï¼ˆä¾‹å¦‚ï¼Œåœ¨é‡æ–°å¯åŠ¨æˆ–å‡çº§æœŸé—´ï¼‰ã€‚ åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå¯ä»¥å°†äº‹ä»¶ç”¨äºè®¾ç½® metrics å’Œ alerts ç­‰ç›®çš„ï¼Œä½†æ‚¨åº”è¯¥æ³¨æ„æ½œåœ¨çš„ä¸å‡†ç¡®æ€§ã€‚ . /note &amp;gt;}}
éƒ¨ç½² Google Kubernetes Engine åœ¨ Google Kubernetes Engine ä¸­ï¼Œå¦‚æœå¯ç”¨äº†äº‘æ—¥å¿—ï¼Œé‚£ä¹ˆäº‹ä»¶å¯¼å‡ºå™¨é»˜è®¤éƒ¨ç½²åœ¨ä¸»èŠ‚ç‚¹è¿è¡Œç‰ˆæœ¬ä¸º 1.7 åŠæ›´é«˜ç‰ˆæœ¬çš„é›†ç¾¤ä¸­ã€‚ ä¸ºäº†é˜²æ­¢å¹²æ‰°æ‚¨çš„å·¥ä½œè´Ÿè½½ï¼Œäº‹ä»¶å¯¼å‡ºå™¨æ²¡æœ‰è®¾ç½®èµ„æºï¼Œå¹¶ä¸”å¤„äºå°½åŠ›è€Œä¸ºçš„ QoS ç±»å‹ä¸­ï¼Œè¿™æ„å‘³ç€å®ƒå°†åœ¨èµ„æºåŒ®ä¹çš„æƒ…å†µä¸‹ç¬¬ä¸€ä¸ªè¢«æ€æ­»ã€‚ å¦‚æœè¦å¯¼å‡ºäº‹ä»¶ï¼Œè¯·ç¡®ä¿æœ‰è¶³å¤Ÿçš„èµ„æºç»™äº‹ä»¶å¯¼å‡ºå™¨ Pod ä½¿ç”¨ã€‚ è¿™å¯èƒ½ä¼šå› ä¸ºå·¥ä½œè´Ÿè½½çš„ä¸åŒè€Œæœ‰æ‰€ä¸åŒï¼Œä½†å¹³å‡è€Œè¨€ï¼Œéœ€è¦å¤§çº¦ 100MB çš„å†…å­˜å’Œ 100m çš„ CPUã€‚
éƒ¨ç½²åˆ°ç°æœ‰é›†ç¾¤ ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å°†äº‹ä»¶å¯¼å‡ºå™¨éƒ¨ç½²åˆ°æ‚¨çš„é›†ç¾¤ï¼š
kubectl create -f https://k8s.io/examples/debug/event-exporter.yaml ç”±äºäº‹ä»¶å¯¼å‡ºå™¨è®¿é—® Kubernetes APIï¼Œå› æ­¤å®ƒéœ€è¦æƒé™æ‰èƒ½è®¿é—®ã€‚ ä»¥ä¸‹çš„éƒ¨ç½²é…ç½®ä¸ºä½¿ç”¨ RBAC æˆæƒã€‚ å®ƒè®¾ç½®æœåŠ¡å¸æˆ·å’Œé›†ç¾¤è§’è‰²ç»‘å®šï¼Œä»¥å…è®¸äº‹ä»¶å¯¼å‡ºå™¨è¯»å–äº‹ä»¶ã€‚ ä¸ºäº†ç¡®ä¿äº‹ä»¶å¯¼å‡ºå™¨ Pod ä¸ä¼šä»èŠ‚ç‚¹ä¸­é€€å‡ºï¼Œæ‚¨å¯ä»¥å¦å¤–è®¾ç½®èµ„æºè¯·æ±‚ã€‚ å¦‚å‰æ‰€è¿°ï¼Œ100MB å†…å­˜å’Œ 100m CPU åº”è¯¥å°±è¶³å¤Ÿäº†ã€‚</description>
    </item>
    
    <item>
      <title>ä½¿ç”¨ crictl å¯¹ Kubernetes èŠ‚ç‚¹è¿›è¡Œè°ƒè¯•</title>
      <link>https://lijun.in/tasks/debug-application-cluster/crictl/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://lijun.in/tasks/debug-application-cluster/crictl/</guid>
      <description>. feature-state for_k8s_version=&amp;quot;v1.11&amp;rdquo; state=&amp;quot;stable&amp;rdquo; &amp;gt;}}
crictl æ˜¯ CRI å…¼å®¹çš„å®¹å™¨è¿è¡Œæ—¶å‘½ä»¤è¡Œæ¥å£ã€‚ æ‚¨å¯ä»¥ä½¿ç”¨å®ƒæ¥æ£€æŸ¥å’Œè°ƒè¯• Kubernetes èŠ‚ç‚¹ä¸Šçš„å®¹å™¨è¿è¡Œæ—¶å’Œåº”ç”¨ç¨‹åºã€‚ crictlå’Œå®ƒçš„æºä»£ç åœ¨ cri-tools ä»£ç åº“ã€‚
. heading &amp;ldquo;prerequisites&amp;rdquo; %}} crictl éœ€è¦å¸¦æœ‰ CRI è¿è¡Œæ—¶çš„ Linux æ“ä½œç³»ç»Ÿã€‚
å®‰è£… crictl æ‚¨å¯ä»¥ä» cri-tools å‘å¸ƒé¡µé¢ä¸‹è½½ä¸€ä¸ªå‹ç¼©çš„ crictl å½’æ¡£æ–‡ä»¶ï¼Œç”¨äºå‡ ç§ä¸åŒçš„æ¶æ„ã€‚ ä¸‹è½½ä¸æ‚¨çš„ kubernetes ç‰ˆæœ¬ç›¸å¯¹åº”çš„ç‰ˆæœ¬ã€‚ æå–å®ƒå¹¶å°†å…¶ç§»åŠ¨åˆ°ç³»ç»Ÿè·¯å¾„ä¸Šçš„æŸä¸ªä½ç½®ï¼Œä¾‹å¦‚/usr/local/bin/ã€‚
ä¸€èˆ¬ç”¨æ³• crictl å‘½ä»¤æœ‰å‡ ä¸ªå­å‘½ä»¤å’Œè¿è¡Œæ—¶å‚æ•°ã€‚ æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·ä½¿ç”¨ crictl help æˆ– crictl &amp;lt;subcommand&amp;gt; help è·å–å¸®åŠ©ä¿¡æ¯ã€‚
crictl é»˜è®¤è¿æ¥åˆ° unix:///var/run/dockershim.sockã€‚ å¯¹äºå…¶ä»–çš„è¿è¡Œæ—¶ï¼Œæ‚¨å¯ä»¥ç”¨å¤šç§ä¸åŒçš„æ–¹æ³•è®¾ç½®ç«¯ç‚¹ï¼š
 é€šè¿‡è®¾ç½®å‚æ•° --runtime-endpoint å’Œ --image-endpoint é€šè¿‡è®¾ç½®ç¯å¢ƒå˜é‡ CONTAINER_RUNTIME_ENDPOINT å’Œ IMAGE_SERVICE_ENDPOINT é€šè¿‡åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®ç«¯ç‚¹ --config=/etc/crictl.yaml  æ‚¨è¿˜å¯ä»¥åœ¨è¿æ¥åˆ°æœåŠ¡å™¨å¹¶å¯ç”¨æˆ–ç¦ç”¨è°ƒè¯•æ—¶æŒ‡å®šè¶…æ—¶å€¼ï¼Œæ–¹æ³•æ˜¯åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®š timeout æˆ– debug å€¼ï¼Œæˆ–è€…ä½¿ç”¨ --timeout å’Œ --debug å‘½ä»¤è¡Œå‚æ•°ã€‚</description>
    </item>
    
    <item>
      <title>ä½¿ç”¨ ElasticSearch å’Œ Kibana è¿›è¡Œæ—¥å¿—ç®¡ç†</title>
      <link>https://lijun.in/tasks/debug-application-cluster/logging-elasticsearch-kibana/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://lijun.in/tasks/debug-application-cluster/logging-elasticsearch-kibana/</guid>
      <description>åœ¨ Google Compute Engine (GCE) å¹³å°ä¸Šï¼Œé»˜è®¤çš„æ—¥å¿—ç®¡ç†æ”¯æŒç›®æ ‡æ˜¯ Stackdriver Loggingï¼Œåœ¨ ä½¿ç”¨ Stackdriver Logging ç®¡ç†æ—¥å¿—ä¸­è¯¦ç»†æè¿°äº†è¿™ä¸€ç‚¹ã€‚
æœ¬æ–‡ä»‹ç»äº†å¦‚ä½•è®¾ç½®ä¸€ä¸ªé›†ç¾¤ï¼Œå°†æ—¥å¿—å¯¼å…¥Elasticsearchï¼Œå¹¶ä½¿ç”¨ Kibana æŸ¥çœ‹æ—¥å¿—ï¼Œä½œä¸ºåœ¨ GCE ä¸Šè¿è¡Œåº”ç”¨æ—¶ä½¿ç”¨ Stackdriver Logging ç®¡ç†æ—¥å¿—çš„æ›¿ä»£æ–¹æ¡ˆã€‚
. note &amp;gt;}}
æ‚¨ä¸èƒ½åœ¨ Google Kubernetes Engine å¹³å°è¿è¡Œçš„ Kubernetes é›†ç¾¤ä¸Šè‡ªåŠ¨çš„éƒ¨ç½² Elasticsearch å’Œ Kibanaã€‚æ‚¨å¿…é¡»æ‰‹åŠ¨éƒ¨ç½²å®ƒä»¬ã€‚ . /note &amp;gt;}}
è¦ä½¿ç”¨ Elasticsearch å’Œ Kibana å¤„ç†é›†ç¾¤æ—¥å¿—ï¼Œæ‚¨åº”è¯¥åœ¨ä½¿ç”¨ kube-up.sh è„šæœ¬åˆ›å»ºé›†ç¾¤æ—¶è®¾ç½®ä¸‹é¢æ‰€ç¤ºçš„ç¯å¢ƒå˜é‡ï¼š
KUBE_LOGGING_DESTINATION=elasticsearch æ‚¨è¿˜åº”è¯¥ç¡®ä¿è®¾ç½®äº† KUBE_ENABLE_NODE_LOGGING=true ï¼ˆè¿™æ˜¯ GCE å¹³å°çš„é»˜è®¤è®¾ç½®ï¼‰ã€‚
ç°åœ¨ï¼Œå½“æ‚¨åˆ›å»ºé›†ç¾¤æ—¶ï¼Œå°†æœ‰ä¸€æ¡æ¶ˆæ¯å°†æŒ‡ç¤ºæ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œçš„ Fluentd æ—¥å¿—æ”¶é›†å®ˆæŠ¤è¿›ç¨‹ä»¥ ElasticSearch ä¸ºæ—¥å¿—è¾“å‡ºç›®æ ‡ï¼š
$ cluster/kube-up.sh ... Project: kubernetes-satnam Zone: us-central1-b ... calling kube-up Project: kubernetes-satnam Zone: us-central1-b +++ Staging server tars to Google Storage: gs://kubernetes-staging-e6d0e81793/devel +++ kubernetes-server-linux-amd64.</description>
    </item>
    
    <item>
      <title>ä½¿ç”¨ Falco å®¡è®¡</title>
      <link>https://lijun.in/tasks/debug-application-cluster/falco/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://lijun.in/tasks/debug-application-cluster/falco/</guid>
      <description>ä½¿ç”¨ Falco é‡‡é›†å®¡è®¡äº‹ä»¶ Falcoæ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œç”¨äºä¸ºäº‘åŸç”Ÿå¹³å°æä¾›å…¥ä¾µå’Œå¼‚å¸¸æ£€æµ‹ã€‚æœ¬èŠ‚ä»‹ç»å¦‚ä½•è®¾ç½® Falcoã€å¦‚ä½•å°†å®¡è®¡äº‹ä»¶å‘é€åˆ° Falco å…¬å¼€çš„ Kubernetes Audit ç«¯ç‚¹ã€ä»¥åŠ Falco å¦‚ä½•åº”ç”¨ä¸€ç»„è§„åˆ™æ¥è‡ªåŠ¨æ£€æµ‹å¯ç–‘è¡Œä¸ºã€‚
å®‰è£… Falco ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•å®‰è£… Falco ï¼š
 [ç‹¬ç«‹å®‰è£… Falco][falco_installation] [Kubernetes DaemonSet][falco_installation] [Falco Helm Chart][falco_helm_chart]  å®‰è£…å®Œæˆ Falco åï¼Œè¯·ç¡®ä¿å°†å…¶é…ç½®ä¸ºå…¬å¼€ Audit Webhookã€‚ä¸ºæ­¤ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹é…ç½®ï¼š
webserver: enabled: true listen_port: 8765 k8s_audit_endpoint: /k8s_audit ssl_enabled: false ssl_certificate: /etc/falco/falco.pem æ­¤é…ç½®é€šå¸¸ä½äº /etc/falco/falco.yaml æ–‡ä»¶ä¸­ã€‚å¦‚æœ Falco ä½œä¸º Kubernetes DaemonSet å®‰è£…ï¼Œè¯·ç¼–è¾‘ falco-config ConfigMap å¹¶æ·»åŠ æ­¤é…ç½®ã€‚
é…ç½® Kubernetes å®¡è®¡   ä¸º kube-apiserver webhook å®¡è®¡åç«¯åˆ›å»ºä¸€ä¸ªkubeconfigæ–‡ä»¶ã€‚
 cat &amp;lt;&amp;lt;EOF &amp;gt; /etc/kubernetes/audit-webhook-kubeconfig apiVersion: v1 kind: Config clusters: - cluster: server: http://&amp;lt;ip_of_falco&amp;gt;:8765/k8s_audit name: falco contexts: - context: cluster: falco user: &amp;quot;&amp;quot; name: default-context current-context: default-context preferences: {} users: [] EOF     ä½¿ç”¨ä»¥ä¸‹é€‰é¡¹å¯åŠ¨ kube-apiserverï¼š</description>
    </item>
    
    <item>
      <title>åœ¨æœ¬åœ°å¼€å‘å’Œè°ƒè¯•æœåŠ¡</title>
      <link>https://lijun.in/tasks/debug-application-cluster/local-debugging/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://lijun.in/tasks/debug-application-cluster/local-debugging/</guid>
      <description>Kubernetes åº”ç”¨ç¨‹åºé€šå¸¸ç”±å¤šä¸ªç‹¬ç«‹çš„æœåŠ¡ç»„æˆï¼Œæ¯ä¸ªæœåŠ¡éƒ½åœ¨è‡ªå·±çš„å®¹å™¨ä¸­è¿è¡Œã€‚ åœ¨è¿œç«¯çš„ Kubernetes é›†ç¾¤ä¸Šå¼€å‘å’Œè°ƒè¯•è¿™äº›æœåŠ¡å¯èƒ½å¾ˆéº»çƒ¦ï¼Œéœ€è¦åœ¨è¿è¡Œçš„å®¹å™¨ä¸Šæ‰“å¼€ shellï¼Œç„¶ååœ¨è¿œç«¯ shell ä¸­è¿è¡Œæ‚¨æ‰€éœ€çš„å·¥å…·ã€‚
telepresence æ˜¯ä¸€ç§å·¥å…·ï¼Œç”¨äºåœ¨æœ¬åœ°è½»æ¾å¼€å‘å’Œè°ƒè¯•æœåŠ¡ï¼ŒåŒæ—¶å°†æœåŠ¡ä»£ç†åˆ°è¿œç¨‹ Kubernetes é›†ç¾¤ã€‚ ä½¿ç”¨ telepresence å¯ä»¥ä¸ºæœ¬åœ°æœåŠ¡ä½¿ç”¨è‡ªå®šä¹‰å·¥å…·ï¼ˆå¦‚è°ƒè¯•å™¨å’Œ IDEï¼‰ï¼Œå¹¶æä¾›å¯¹ Configmapã€Secrets å’Œè¿œç¨‹é›†ç¾¤ä¸Šè¿è¡Œçš„æœåŠ¡çš„å®Œå…¨è®¿é—®ã€‚
 Kubernetes é›†ç¾¤å®‰è£…å®Œæ¯• é…ç½®å¥½ kubectl ä¸é›†ç¾¤äº¤äº’ Telepresence å®‰è£…å®Œæ¯•  æ‰“å¼€ç»ˆç«¯ï¼Œä¸å¸¦å‚æ•°è¿è¡Œ telepresenceï¼Œä»¥æ‰“å¼€ telepresence shellã€‚è¿™ä¸ª shell åœ¨æœ¬åœ°è¿è¡Œï¼Œä½¿æ‚¨å¯ä»¥å®Œå…¨è®¿é—®æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿã€‚
telepresence shell çš„ä½¿ç”¨æ–¹å¼å¤šç§å¤šæ ·ã€‚ ä¾‹å¦‚ï¼Œåœ¨ä½ çš„ç¬”è®°æœ¬ç”µè„‘ä¸Šå†™ä¸€ä¸ª shell è„šæœ¬ï¼Œç„¶åç›´æ¥åœ¨ shell ä¸­å®æ—¶è¿è¡Œå®ƒã€‚ æ‚¨ä¹Ÿå¯ä»¥åœ¨è¿œç«¯ shell ä¸Šæ‰§è¡Œæ­¤æ“ä½œï¼Œä½†è¿™æ ·å¯èƒ½æ— æ³•ä½¿ç”¨é¦–é€‰çš„ä»£ç ç¼–è¾‘å™¨ï¼Œå¹¶ä¸”åœ¨å®¹å™¨ç»ˆæ­¢æ—¶è„šæœ¬å°†è¢«åˆ é™¤ã€‚
å¼€å‘å’Œè°ƒè¯•ç°æœ‰çš„æœåŠ¡ åœ¨ Kubernetes ä¸Šå¼€å‘åº”ç”¨ç¨‹åºæ—¶ï¼Œé€šå¸¸å¯¹å•ä¸ªæœåŠ¡è¿›è¡Œç¼–ç¨‹æˆ–è°ƒè¯•ã€‚ æœåŠ¡å¯èƒ½éœ€è¦è®¿é—®å…¶ä»–æœåŠ¡ä»¥è¿›è¡Œæµ‹è¯•å’Œè°ƒè¯•ã€‚ ä¸€ç§é€‰æ‹©æ˜¯ä½¿ç”¨è¿ç»­éƒ¨ç½²ç®¡é“ï¼Œä½†å³ä½¿æœ€å¿«çš„éƒ¨ç½²ç®¡é“ä¹Ÿä¼šåœ¨ç¨‹åºæˆ–è°ƒè¯•å‘¨æœŸä¸­å¼•å…¥å»¶è¿Ÿã€‚
ä½¿ç”¨ --swap-deployment é€‰é¡¹å°†ç°æœ‰éƒ¨ç½²ä¸ Telepresence ä»£ç†äº¤æ¢ã€‚äº¤æ¢å…è®¸æ‚¨åœ¨æœ¬åœ°è¿è¡ŒæœåŠ¡å¹¶èƒ½å¤Ÿè¿æ¥åˆ°è¿œç«¯çš„ Kubernetes é›†ç¾¤ã€‚è¿œç«¯çš„é›†ç¾¤ä¸­çš„æœåŠ¡ç°åœ¨å°±å¯ä»¥è®¿é—®æœ¬åœ°è¿è¡Œçš„å®ä¾‹ã€‚
åˆ°è¿è¡Œ telepresence å¹¶å¸¦æœ‰ --swap-deployment é€‰é¡¹ï¼Œè¯·è¾“å…¥ï¼š
telepresence --swap-deployment $DEPLOYMENT_NAME
è¿™é‡Œçš„ $DEPLOYMENT_NAME æ˜¯æ‚¨ç°æœ‰çš„éƒ¨ç½²åç§°ã€‚
è¿è¡Œæ­¤å‘½ä»¤å°†ç”Ÿæˆ shellã€‚åœ¨ shell ä¸­ï¼Œå¯åŠ¨æ‚¨çš„æœåŠ¡ã€‚ ç„¶åï¼Œæ‚¨å°±å¯ä»¥åœ¨æœ¬åœ°å¯¹æºä»£ç è¿›è¡Œç¼–è¾‘ã€ä¿å­˜å¹¶èƒ½çœ‹åˆ°æ›´æ”¹ç«‹å³ç”Ÿæ•ˆã€‚æ‚¨è¿˜å¯ä»¥åœ¨è°ƒè¯•å™¨æˆ–ä»»ä½•å…¶ä»–æœ¬åœ°å¼€å‘å·¥å…·ä¸­è¿è¡ŒæœåŠ¡ã€‚</description>
    </item>
    
    <item>
      <title>åº”ç”¨æ•…éšœæ’æŸ¥</title>
      <link>https://lijun.in/tasks/debug-application-cluster/debug-application/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://lijun.in/tasks/debug-application-cluster/debug-application/</guid>
      <description>æœ¬æŒ‡å—å¸®åŠ©ç”¨æˆ·æ¥è°ƒè¯•kubernetesä¸Šé‚£äº›æ²¡æœ‰æ­£å¸¸è¿è¡Œçš„åº”ç”¨ã€‚ æœ¬æŒ‡å—ä¸èƒ½è°ƒè¯•é›†ç¾¤ã€‚å¦‚æœæƒ³è°ƒè¯•é›†ç¾¤çš„è¯ï¼Œè¯·å‚é˜…è¿™é‡Œã€‚
. toc &amp;gt;}}
è¯Šæ–­é—®é¢˜ æ•…éšœæ’æŸ¥çš„ç¬¬ä¸€æ­¥æ˜¯å…ˆç»™é—®é¢˜åˆ†ä¸‹ç±»ã€‚è¿™ä¸ªé—®é¢˜æ˜¯ä»€ä¹ˆï¼ŸPodsï¼ŒReplication Controlleræˆ–è€…Serviceï¼Ÿ
 Debugging Pods Debugging Replication Controllers Debugging Services  Debugging Pods è°ƒè¯•podçš„ç¬¬ä¸€æ­¥æ˜¯çœ‹ä¸€ä¸‹è¿™ä¸ªpodçš„ä¿¡æ¯ï¼Œç”¨å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹ä¸€ä¸‹podçš„å½“å‰çŠ¶æ€å’Œæœ€è¿‘çš„äº‹ä»¶ï¼š
$ kubectl describe pods ${POD_NAME} æŸ¥çœ‹ä¸€ä¸‹podä¸­çš„å®¹å™¨æ‰€å¤„çš„çŠ¶æ€ã€‚è¿™äº›å®¹å™¨çš„çŠ¶æ€éƒ½æ˜¯Runningå—ï¼Ÿæœ€è¿‘æœ‰æ²¡æœ‰é‡å¯è¿‡ï¼Ÿ
åé¢çš„è°ƒè¯•éƒ½æ˜¯è¦ä¾é podsçš„çŠ¶æ€çš„ã€‚
podåœç•™åœ¨pendingçŠ¶æ€ å¦‚æœä¸€ä¸ªpodå¡åœ¨PendingçŠ¶æ€ï¼Œåˆ™è¡¨ç¤ºè¿™ä¸ªpodæ²¡æœ‰è¢«è°ƒåº¦åˆ°ä¸€ä¸ªèŠ‚ç‚¹ä¸Šã€‚é€šå¸¸è¿™æ˜¯å› ä¸ºèµ„æºä¸è¶³å¼•èµ·çš„ã€‚ æ•²ä¸€ä¸‹kubectl describe ...è¿™ä¸ªå‘½ä»¤ï¼Œè¾“å‡ºçš„ä¿¡æ¯é‡Œé¢åº”è¯¥æœ‰æ˜¾ç¤ºä¸ºä»€ä¹ˆæ²¡è¢«è°ƒåº¦çš„åŸå› ã€‚ å¸¸è§åŸå› å¦‚ä¸‹ï¼š
  èµ„æºä¸è¶³: ä½ å¯èƒ½è€—å°½äº†é›†ç¾¤ä¸Šæ‰€æœ‰çš„CPUå’Œå†…å­˜ï¼Œæ­¤æ—¶ï¼Œä½ éœ€è¦åˆ é™¤podsï¼Œè°ƒæ•´èµ„æºè¯·æ±‚ï¼Œæˆ–è€…å¢åŠ èŠ‚ç‚¹ã€‚ æ›´å¤šä¿¡æ¯è¯·å‚é˜…Compute Resources document
  ä½¿ç”¨äº†hostPort: å¦‚æœç»‘å®šä¸€ä¸ªpodåˆ°hostPortï¼Œé‚£ä¹ˆèƒ½åˆ›å»ºçš„podä¸ªæ•°å°±æœ‰é™äº†ã€‚ å¤šæ•°æƒ…å†µä¸‹ï¼ŒhostPortæ˜¯éå¿…è¦çš„ï¼Œè€Œåº”è¯¥é‡‡ç”¨æœåŠ¡æ¥æš´éœ²podã€‚ å¦‚æœç¡®å®éœ€è¦ä½¿ç”¨hostPortï¼Œé‚£ä¹ˆèƒ½åˆ›å»ºçš„podçš„æ•°é‡å°±æ˜¯èŠ‚ç‚¹çš„ä¸ªæ•°ã€‚
  podåœç•™åœ¨waitingçŠ¶æ€ å¦‚æœä¸€ä¸ªpodå¡åœ¨WaitingçŠ¶æ€ï¼Œåˆ™è¡¨ç¤ºè¿™ä¸ªpodå·²ç»è°ƒè¯•åˆ°èŠ‚ç‚¹ä¸Šï¼Œä½†æ˜¯æ²¡æœ‰è¿è¡Œèµ·æ¥ã€‚ å†æ¬¡æ•²ä¸€ä¸‹kubectl describe ...è¿™ä¸ªå‘½ä»¤æ¥æŸ¥çœ‹ç›¸å…³ä¿¡æ¯ã€‚ æœ€å¸¸è§çš„åŸå› æ˜¯æ‹‰å–é•œåƒå¤±è´¥ã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸‰ç§æ–¹å¼æ¥æ£€æŸ¥ï¼š
 ä½¿ç”¨çš„é•œåƒåå­—æ­£ç¡®å—ï¼Ÿ é•œåƒä»“åº“é‡Œæœ‰æ²¡æœ‰è¿™ä¸ªé•œåƒï¼Ÿ ç”¨docker pull &amp;lt;image&amp;gt;å‘½ä»¤æ‰‹åŠ¨æ‹‰ä¸‹é•œåƒè¯•è¯•ã€‚  podå¤„äºcrashingçŠ¶æ€æˆ–è€…unhealthy é¦–å…ˆï¼Œçœ‹ä¸€ä¸‹å®¹å™¨çš„log:
$ kubectl logs ${POD_NAME} ${CONTAINER_NAME} å¦‚æœå®¹å™¨æ˜¯crashedçš„ï¼Œç”¨å¦‚ä¸‹å‘½ä»¤å¯ä»¥çœ‹åˆ°crashçš„log:
$ kubectl logs --previous ${POD_NAME} ${CONTAINER_NAME} æˆ–è€…ï¼Œç”¨execåœ¨å®¹å™¨å†…è¿è¡Œä¸€äº›å‘½ä»¤ï¼š</description>
    </item>
    
    <item>
      <title>åº”ç”¨è‡ªæµ‹ä¸è°ƒè¯•</title>
      <link>https://lijun.in/tasks/debug-application-cluster/debug-application-introspection/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://lijun.in/tasks/debug-application-cluster/debug-application-introspection/</guid>
      <description>è¿è¡Œåº”ç”¨æ—¶ï¼Œä¸å¯é¿å…çš„éœ€è¦å®šä½é—®é¢˜ã€‚ å‰é¢æˆ‘ä»¬ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ kubectl get pods æ¥æŸ¥è¯¢ pod çš„ç®€å•ä¿¡æ¯ã€‚ é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ç³»åˆ—çš„æ–¹æ³•æ¥è·å–åº”ç”¨çš„æ›´è¯¦ç»†ä¿¡æ¯ã€‚
ä½¿ç”¨ kubectl describe pod å‘½ä»¤è·å– pod è¯¦æƒ… ä¸ä¹‹å‰çš„ä¾‹å­ç±»ä¼¼ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ª Deployment æ¥åˆ›å»ºä¸¤ä¸ª podã€‚
. codenew file=&amp;quot;application/nginx-with-request.yaml&amp;rdquo; &amp;gt;}}
ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤åˆ›å»º deploymentï¼š
kubectl apply -f https://k8s.io/examples/application/nginx-with-request.yaml deployment.apps/nginx-deployment created ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹ pod çŠ¶æ€ï¼š
kubectl get pods NAME READY STATUS RESTARTS AGE nginx-deployment-1006230814-6winp 1/1 Running 0 11s nginx-deployment-1006230814-fmgu3 1/1 Running 0 11s æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ kubectl describe pod å‘½ä»¤æ¥æŸ¥è¯¢æ¯ä¸ª pod çš„æ›´å¤šä¿¡æ¯ï¼Œæ¯”å¦‚ï¼š
kubectl describe pod nginx-deployment-1006230814-6winp Name:	nginx-deployment-1006230814-6winp Namespace:	default Node:	kubernetes-node-wul5/10.240.0.9 Start Time:	Thu, 24 Mar 2016 01:39:49 +0000 Labels:	app=nginx,pod-template-hash=1006230814 Annotations: kubernetes.</description>
    </item>
    
    <item>
      <title>æ’é”™</title>
      <link>https://lijun.in/tasks/debug-application-cluster/troubleshooting/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://lijun.in/tasks/debug-application-cluster/troubleshooting/</guid>
      <description>æœ‰æ—¶å€™äº‹æƒ…ä¼šå‡ºé”™ã€‚æœ¬æŒ‡å—æ—¨åœ¨æ­£ç¡®è§£å†³è¿™äº›é—®é¢˜ã€‚å®ƒåŒ…å«ä¸¤ä¸ªéƒ¨åˆ†ï¼š
 åº”ç”¨æ’é”™ - ç”¨äºéƒ¨ç½²ä»£ç åˆ° Kubernetes å¹¶æƒ³çŸ¥é“ä»£ç ä¸ºä»€ä¹ˆä¸èƒ½æ­£å¸¸è¿è¡Œçš„ç”¨æˆ·ã€‚ é›†ç¾¤æ’é”™ - ç”¨äºé›†ç¾¤ç®¡ç†å‘˜ä»¥åŠ Kubernetes é›†ç¾¤è¡¨ç°å¼‚å¸¸çš„ç”¨æˆ·ã€‚  æ‚¨ä¹Ÿåº”è¯¥æŸ¥çœ‹æ‰€ç”¨ç‰ˆæœ¬çš„å·²çŸ¥é—®é¢˜ã€‚
è·å–å¸®åŠ© å¦‚æœæ‚¨çš„é—®é¢˜åœ¨ä¸Šè¿°æŒ‡å—ä¸­æ²¡æœ‰å¾—åˆ°ç­”æ¡ˆï¼Œæ‚¨è¿˜æœ‰å¦å¤–å‡ ç§æ–¹å¼ä» Kubernetes å›¢é˜Ÿè·å¾—å¸®åŠ©ã€‚
æé—® ç½‘ç«™ä¸Šçš„æ–‡æ¡£é’ˆå¯¹å›ç­”å„ç±»é—®é¢˜è¿›è¡Œäº†ç»“æ„åŒ–ç»„ç»‡å’Œåˆ†ç±»ã€‚ æ¦‚å¿µéƒ¨åˆ†è§£é‡Šäº† Kubernetes ä½“ç³»ç»“æ„ä»¥åŠæ¯ä¸ªç»„ä»¶çš„å·¥ä½œæ–¹å¼ï¼Œå®‰è£…éƒ¨åˆ†æä¾›äº†å…¥é—¨çš„å®ç”¨è¯´æ˜ã€‚ ä»»åŠ¡éƒ¨åˆ†å±•ç¤ºäº†å¦‚ä½•å®Œæˆå¸¸ç”¨ä»»åŠ¡ï¼Œå…¥é—¨éƒ¨åˆ†åˆ™æ˜¯å¯¹ç°å®ä¸–ç•Œã€ç‰¹å®šè¡Œä¸šæˆ–ç«¯åˆ°ç«¯å¼€å‘åœºæ™¯çš„æ›´å…¨é¢çš„æ¼”ç»ƒã€‚ å‚è€ƒéƒ¨åˆ†æä¾›äº†è¯¦ç»†çš„ [Kubernetes API](/docs/reference/generated/kubernetes-api/. param &amp;ldquo;version&amp;rdquo; &amp;gt;}}/) æ–‡æ¡£å’Œå‘½ä»¤è¡Œ (CLI) æ¥å£ï¼Œä¾‹å¦‚kubectlã€‚
æ‚¨è¿˜å¯ä»¥æ‰¾åˆ°å †æ ˆæº¢å‡ºç›¸å…³çš„ä¸»é¢˜ï¼š
 Kubernetes Google Kubernetes Engine  æ±‚æ•‘ï¼æˆ‘çš„é—®é¢˜è¿˜æ²¡æœ‰è§£å†³ï¼æˆ‘éœ€è¦ç«‹å³å¾—åˆ°å¸®åŠ©ï¼ å †æ ˆæº¢å‡º ç¤¾åŒºä¸­çš„å…¶ä»–äººå¯èƒ½å·²ç»é—®è¿‡å’Œæ‚¨ç±»ä¼¼çš„é—®é¢˜ï¼Œè¿™æˆ–è®¸èƒ½å¸®åŠ©è§£å†³æ‚¨çš„é—®é¢˜ã€‚ Kubernetes å›¢é˜Ÿè¿˜ä¼šç›‘è§†å¸¦æœ‰ Kubernetes æ ‡ç­¾çš„å¸–å­ã€‚ å¦‚æœç°æœ‰çš„é—®é¢˜å¯¹æ‚¨æ²¡æœ‰å¸®åŠ©ï¼Œè¯·é—®ä¸€ä¸ªæ–°é—®é¢˜!
Slack Kubernetes å›¢é˜Ÿåœ¨ Slack ä¸­å»ºæœ‰ #kubernetes-users é¢‘é“ã€‚ æ‚¨å¯ä»¥åœ¨è¿™é‡Œå‚åŠ ä¸ Kubernetes å›¢é˜Ÿçš„è®¨è®ºã€‚ Slack éœ€è¦æ³¨å†Œï¼Œä½† Kubernetes å›¢é˜Ÿå…¬å¼€é‚€è¯·ä»»ä½•äººåœ¨è¿™é‡Œæ³¨å†Œã€‚ æ¬¢è¿æ‚¨éšæ—¶æ¥é—®ä»»ä½•é—®é¢˜ã€‚
ä¸€æ—¦æ³¨å†Œå®Œæˆï¼Œæ‚¨å°±å¯ä»¥æµè§ˆå„ç§æ„Ÿå…´è¶£çš„é¢‘é“åˆ—è¡¨ã€‚ ä¾‹å¦‚ï¼ŒKubernetes æ–°äººå¯èƒ½è¿˜æƒ³åŠ å…¥ #kubernetes-novice é¢‘é“ã€‚ä½œä¸ºå¦ä¸€ä¸ªä¾‹å­ï¼Œå¼€å‘äººå‘˜åº”è¯¥åŠ å…¥ #kubernetes-dev é¢‘é“ã€‚</description>
    </item>
    
    <item>
      <title>ç¡®å®š Pod å¤±è´¥çš„åŸå› </title>
      <link>https://lijun.in/tasks/debug-application-cluster/determine-reason-pod-failure/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://lijun.in/tasks/debug-application-cluster/determine-reason-pod-failure/</guid>
      <description>æœ¬æ–‡ä»‹ç»å¦‚ä½•ç¼–å†™å’Œè¯»å–å®¹å™¨çš„ç»ˆæ­¢æ¶ˆæ¯ã€‚
ç»ˆæ­¢æ¶ˆæ¯ä¸ºå®¹å™¨æä¾›äº†ä¸€ç§æ–¹æ³•ï¼Œå¯ä»¥å°†æœ‰å…³è‡´å‘½äº‹ä»¶çš„ä¿¡æ¯å†™å…¥æŸä¸ªä½ç½®ï¼Œåœ¨è¯¥ä½ç½®å¯ä»¥é€šè¿‡ä»ªè¡¨æ¿å’Œç›‘æ§è½¯ä»¶ç­‰å·¥å…·è½»æ¾æ£€ç´¢å’Œæ˜¾ç¤ºè‡´å‘½äº‹ä»¶ã€‚ åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ‚¨æ”¾å…¥ç»ˆæ­¢æ¶ˆæ¯ä¸­çš„ä¿¡æ¯ä¹Ÿåº”è¯¥å†™å…¥å¸¸è§„ Kubernetes æ—¥å¿—ã€‚
. heading &amp;ldquo;prerequisites&amp;rdquo; %}} . include &amp;ldquo;task-tutorial-prereqs.md&amp;rdquo; &amp;gt;}} . version-check &amp;gt;}}
è¯»å†™ç»ˆæ­¢æ¶ˆæ¯ åœ¨æœ¬ç»ƒä¹ ä¸­ï¼Œæ‚¨å°†åˆ›å»ºè¿è¡Œä¸€ä¸ªå®¹å™¨çš„ Podã€‚ é…ç½®æ–‡ä»¶æŒ‡å®šåœ¨å®¹å™¨å¯åŠ¨æ—¶è¦è¿è¡Œçš„å‘½ä»¤ã€‚
. codenew file=&amp;quot;debug/termination.yaml&amp;rdquo; &amp;gt;}}
   kubectl create -f https://k8s.io/examples/debug/termination.yaml  YAML æ–‡ä»¶ä¸­ï¼Œåœ¨ cmd å’Œ args å­—æ®µï¼Œä½ å¯ä»¥çœ‹åˆ°å®¹å™¨ä¼‘çœ  10 ç§’ç„¶åå°† &amp;ldquo;Sleep expired&amp;rdquo; å†™å…¥ /dev/termination-log æ–‡ä»¶ã€‚ å®¹å™¨å†™å®Œ &amp;ldquo;Sleep expired&amp;rdquo; æ¶ˆæ¯åï¼Œå®ƒå°±ç»ˆæ­¢äº†ã€‚
   kubectl get pod termination-demo  é‡å¤å‰é¢çš„å‘½ä»¤ç›´åˆ° Pod ä¸å†è¿è¡Œã€‚
   kubectl get pod --output=yaml   apiVersion: v1 kind: Pod .</description>
    </item>
    
    <item>
      <title>èŠ‚ç‚¹å¥åº·ç›‘æµ‹</title>
      <link>https://lijun.in/tasks/debug-application-cluster/monitor-node-health/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://lijun.in/tasks/debug-application-cluster/monitor-node-health/</guid>
      <description>èŠ‚ç‚¹é—®é¢˜æ¢æµ‹å™¨ æ˜¯ä¸€ä¸ª DaemonSet ç”¨æ¥ç›‘æ§èŠ‚ç‚¹å¥åº·ã€‚å®ƒä»å„ç§å®ˆæŠ¤è¿›ç¨‹æ”¶é›†èŠ‚ç‚¹é—®é¢˜ï¼Œå¹¶ä»¥NodeCondition å’Œ [Event](/docs/reference/generated/kubernetes-api/. param &amp;ldquo;version&amp;rdquo; &amp;gt;}}/#event-v1-core) çš„å½¢å¼æŠ¥å‘Šç»™ apiserver ã€‚
å®ƒç°åœ¨æ”¯æŒä¸€äº›å·²çŸ¥çš„å†…æ ¸é—®é¢˜æ£€æµ‹ï¼Œå¹¶å°†éšç€æ—¶é—´çš„æ¨ç§»ï¼Œæ£€æµ‹æ›´å¤šèŠ‚ç‚¹é—®é¢˜ã€‚
ç›®å‰ï¼ŒKubernetes ä¸ä¼šå¯¹èŠ‚ç‚¹é—®é¢˜æ£€æµ‹å™¨ç›‘æµ‹åˆ°çš„èŠ‚ç‚¹çŠ¶æ€å’Œäº‹ä»¶é‡‡å–ä»»ä½•æ“ä½œã€‚å°†æ¥å¯èƒ½ä¼šå¼•å…¥ä¸€ä¸ªè¡¥æ•‘ç³»ç»Ÿæ¥å¤„ç†è¿™äº›èŠ‚ç‚¹é—®é¢˜ã€‚
æ›´å¤šä¿¡æ¯è¯·å‚é˜… è¿™é‡Œã€‚
. heading &amp;ldquo;prerequisites&amp;rdquo; %}} . include &amp;ldquo;task-tutorial-prereqs.md&amp;rdquo; &amp;gt;}} . version-check &amp;gt;}}
å±€é™æ€§  èŠ‚ç‚¹é—®é¢˜æ£€æµ‹å™¨çš„å†…æ ¸é—®é¢˜æ£€æµ‹ç°åœ¨åªæ”¯æŒåŸºäºæ–‡ä»¶ç±»å‹çš„å†…æ ¸æ—¥å¿—ã€‚ å®ƒä¸æ”¯æŒåƒ journald è¿™æ ·çš„å‘½ä»¤è¡Œæ—¥å¿—å·¥å…·ã€‚   èŠ‚ç‚¹é—®é¢˜æ£€æµ‹å™¨çš„å†…æ ¸é—®é¢˜æ£€æµ‹å¯¹å†…æ ¸æ—¥å¿—æ ¼å¼æœ‰ä¸€å®šè¦æ±‚ï¼Œç°åœ¨å®ƒåªé€‚ç”¨äº Ubuntu å’Œ Debianã€‚ä½†æ˜¯ï¼Œå°†å…¶æ‰©å±•ä¸º æ”¯æŒå…¶å®ƒæ—¥å¿—æ ¼å¼ ä¹Ÿå¾ˆå®¹æ˜“ã€‚  åœ¨ GCE é›†ç¾¤ä¸­å¯ç”¨/ç¦ç”¨ èŠ‚ç‚¹é—®é¢˜æ£€æµ‹å™¨åœ¨ gce é›†ç¾¤ä¸­ä»¥é›†ç¾¤æ’ä»¶çš„å½¢å¼é»˜è®¤å¯ç”¨ã€‚
æ‚¨å¯ä»¥åœ¨è¿è¡Œ kube-up.sh ä¹‹å‰ï¼Œä»¥è®¾ç½®ç¯å¢ƒå˜é‡ KUBE_ENABLE_NODE_PROBLEM_DETECTOR çš„å½¢å¼å¯ç”¨/ç¦ç”¨å®ƒã€‚
åœ¨å…¶å®ƒç¯å¢ƒä¸­ä½¿ç”¨ è¦åœ¨ GCE ä¹‹å¤–çš„å…¶ä»–ç¯å¢ƒä¸­å¯ç”¨èŠ‚ç‚¹é—®é¢˜æ£€æµ‹å™¨ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ kubectl æˆ–æ’ä»¶ podã€‚
Kubectl è¿™æ˜¯åœ¨ GCE ä¹‹å¤–å¯åŠ¨èŠ‚ç‚¹é—®é¢˜æ£€æµ‹å™¨çš„æ¨èæ–¹æ³•ã€‚å®ƒçš„ç®¡ç†æ›´åŠ çµæ´»ï¼Œä¾‹å¦‚è¦†ç›–é»˜è®¤é…ç½®ä»¥ä½¿å…¶é€‚åˆæ‚¨çš„ç¯å¢ƒæˆ–æ£€æµ‹è‡ªå®šä¹‰èŠ‚ç‚¹é—®é¢˜ã€‚
 æ­¥éª¤ 1: node-problem-detector.yaml:  .</description>
    </item>
    
    <item>
      <title>è·å–æ­£åœ¨è¿è¡Œå®¹å™¨çš„ Shell</title>
      <link>https://lijun.in/tasks/debug-application-cluster/get-shell-running-container/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://lijun.in/tasks/debug-application-cluster/get-shell-running-container/</guid>
      <description>æœ¬æ–‡ä»‹ç»æ€æ ·ä½¿ç”¨ kubectl exec å‘½ä»¤è·å–æ­£åœ¨è¿è¡Œå®¹å™¨çš„ Shellã€‚
.% heading &amp;ldquo;prerequisites&amp;rdquo; %}} . include &amp;ldquo;task-tutorial-prereqs.md&amp;rdquo; &amp;gt;}} . version-check &amp;gt;}}
è·å–å®¹å™¨çš„ Shell åœ¨æœ¬ç»ƒä¹ ä¸­ï¼Œä½ å°†åˆ›å»ºåŒ…å«ä¸€ä¸ªå®¹å™¨çš„ Podã€‚å®¹å™¨è¿è¡Œ nginx é•œåƒã€‚ä¸‹é¢æ˜¯ Pod çš„é…ç½®æ–‡ä»¶ï¼š
. codenew file=&amp;quot;application/shell-demo.yaml&amp;rdquo; &amp;gt;}}
åˆ›å»º Podï¼š
kubectl create -f https://k8s.io/examples/application/shell-demo.yaml æ£€æŸ¥å®¹å™¨æ˜¯å¦è¿è¡Œæ­£å¸¸ï¼š
kubectl get pod shell-demo è·å–æ­£åœ¨è¿è¡Œå®¹å™¨çš„ Shellï¼š
kubectl exec -it shell-demo -- /bin/bash . note &amp;gt;}}
åŒç ´æŠ˜å· &amp;ldquo;&amp;ndash;&amp;rdquo; ç”¨äºå°†è¦ä¼ é€’ç»™å‘½ä»¤çš„å‚æ•°ä¸ kubectl çš„å‚æ•°åˆ†å¼€ã€‚ note &amp;gt;}}
åœ¨ shell ä¸­ï¼Œæ‰“å°æ ¹ç›®å½•ï¼š
root@shell-demo:/# ls / åœ¨ shell ä¸­ï¼Œå®éªŒå…¶ä»–å‘½ä»¤ã€‚ä¸‹é¢æ˜¯ä¸€äº›ç¤ºä¾‹ï¼š
root@shell-demo:/# ls / root@shell-demo:/# cat /proc/mounts root@shell-demo:/# cat /proc/1/maps root@shell-demo:/# apt-get update root@shell-demo:/# apt-get install -y tcpdump root@shell-demo:/# tcpdump root@shell-demo:/# apt-get install -y lsof root@shell-demo:/# lsof root@shell-demo:/# apt-get install -y procps root@shell-demo:/# ps aux root@shell-demo:/# ps aux | grep nginx ç¼–å†™ nginx çš„ æ ¹é¡µé¢ åœ¨çœ‹ä¸€ä¸‹ Pod çš„é…ç½®æ–‡ä»¶ã€‚è¯¥ Pod æœ‰ä¸ª emptyDir å·ï¼Œå®¹å™¨å°†è¯¥å·æŒ‚è½½åˆ°äº† /usr/share/nginx/htmlã€‚</description>
    </item>
    
    <item>
      <title>è°ƒè¯• Init å®¹å™¨</title>
      <link>https://lijun.in/tasks/debug-application-cluster/debug-init-containers/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://lijun.in/tasks/debug-application-cluster/debug-init-containers/</guid>
      <description>æ­¤é¡µæ˜¾ç¤ºå¦‚ä½•æ ¸æŸ¥ä¸ init å®¹å™¨æ‰§è¡Œç›¸å…³çš„é—®é¢˜ã€‚ ä¸‹é¢çš„ç¤ºä¾‹å‘½ä»¤è¡Œå°† Pod ç§°ä¸º &amp;lt;pod-name&amp;gt;ï¼Œè€Œ init å®¹å™¨ç§°ä¸º &amp;lt;init-container-1&amp;gt; å’Œ &amp;lt;init-container-2&amp;gt;ã€‚
. heading &amp;ldquo;prerequisites&amp;rdquo; %}} . include &amp;ldquo;task-tutorial-prereqs.md&amp;rdquo; &amp;gt;}} . version-check &amp;gt;}}
 æ‚¨åº”è¯¥ç†Ÿæ‚‰ Init å®¹å™¨çš„åŸºç¡€çŸ¥è¯†ã€‚ æ‚¨åº”è¯¥å·²ç»é…ç½®å¥½ä¸€ä¸ª Init å®¹å™¨ã€‚  æ£€æŸ¥ Init å®¹å™¨çš„çŠ¶æ€ æ˜¾ç¤ºä½ çš„ Pod çš„çŠ¶æ€ï¼š
kubectl get pod &amp;lt;pod-name&amp;gt; ä¾‹å¦‚ï¼ŒçŠ¶æ€ Init:1/2 è¡¨æ˜ä¸¤ä¸ª Init å®¹å™¨ä¸­çš„ä¸€ä¸ªå·²ç»æˆåŠŸå®Œæˆï¼š
NAME READY STATUS RESTARTS AGE &amp;lt;pod-name&amp;gt; 0/1 Init:1/2 0 7s æ›´å¤šçŠ¶æ€å€¼åŠå…¶å«ä¹‰è¯·å‚è€ƒäº†è§£ Pod çš„çŠ¶æ€ã€‚
è·å– Init å®¹å™¨è¯¦æƒ… æŸ¥çœ‹ Init å®¹å™¨è¿è¡Œçš„æ›´å¤šè¯¦æƒ…ï¼š
kubectl describe pod &amp;lt;pod-name&amp;gt; ä¾‹å¦‚ï¼Œå¯¹äºåŒ…å«ä¸¤ä¸ª Init å®¹å™¨çš„ Pod åº”è¯¥æ˜¾ç¤ºå¦‚ä¸‹ä¿¡æ¯ï¼š</description>
    </item>
    
    <item>
      <title>è°ƒè¯• Pods å’Œ Replication Controllers</title>
      <link>https://lijun.in/tasks/debug-application-cluster/debug-pod-replication-controller/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://lijun.in/tasks/debug-application-cluster/debug-pod-replication-controller/</guid>
      <description>æ­¤é¡µé¢å‘Šè¯‰æ‚¨å¦‚ä½•è°ƒè¯• Pod å’Œ ReplicationControllerã€‚
. heading &amp;ldquo;prerequisites&amp;rdquo; %}} . include &amp;ldquo;task-tutorial-prereqs.md&amp;rdquo; &amp;gt;}} . version-check &amp;gt;}}
 æ‚¨åº”è¯¥å…ˆç†Ÿæ‚‰ Pods å’Œ Pod Lifecycle çš„åŸºç¡€æ¦‚å¿µã€‚  è°ƒè¯• Pod è°ƒè¯•ä¸€ä¸ª pod çš„ç¬¬ä¸€æ­¥æ˜¯è§‚å¯Ÿå®ƒã€‚ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ£€æŸ¥è¿™ä¸ª pod çš„å½“å‰çŠ¶æ€å’Œæœ€è¿‘äº‹ä»¶ï¼š
kubectl describe pods ${POD_NAME} çœ‹çœ‹ pod ä¸­çš„å®¹å™¨çš„çŠ¶æ€ã€‚ä»–ä»¬éƒ½æ˜¯ Running å—ï¼Ÿæœ‰æœ€è¿‘é‡å¯äº†å—ï¼Ÿ
æ ¹æ® pod çš„çŠ¶æ€ç»§ç»­è°ƒè¯•ã€‚
æˆ‘çš„ Pod å¡åœ¨ Pending å¦‚æœä¸€ä¸ª pod è¢«å¡åœ¨ Pending çŠ¶æ€ï¼Œå°±æ„å‘³ç€å®ƒä¸èƒ½è°ƒåº¦åœ¨æŸä¸ªèŠ‚ç‚¹ä¸Šã€‚ä¸€èˆ¬æ¥è¯´ï¼Œè¿™æ˜¯å› ä¸ºæŸç§ç±»å‹çš„èµ„æºä¸è¶³è€Œ é˜»æ­¢è°ƒåº¦ã€‚ çœ‹çœ‹ä¸Šé¢çš„å‘½ä»¤ kubectl describe ... çš„è¾“å‡ºã€‚è°ƒåº¦å™¨çš„æ¶ˆæ¯ä¸­åº”è¯¥ä¼šåŒ…å«æ— æ³•è°ƒåº¦ Pod çš„åŸå› ã€‚ åŸå› åŒ…æ‹¬ï¼š
èµ„æºä¸è¶³ æ‚¨å¯èƒ½å·²ç»è€—å°½äº†é›†ç¾¤ä¸­ä¾›åº”çš„ CPU æˆ–å†…å­˜ã€‚åœ¨è¿™ä¸ªæƒ…å†µä¸‹ä½ å¯ä»¥å°è¯•å‡ ä»¶äº‹æƒ…ï¼š
  æ·»åŠ æ›´å¤šèŠ‚ç‚¹ åˆ°é›†ç¾¤ã€‚
  ç»ˆæ­¢ä¸éœ€è¦çš„ pod ä¸º pending ä¸­çš„ pod æä¾›ç©ºé—´ã€‚</description>
    </item>
    
    <item>
      <title>è°ƒè¯• Service</title>
      <link>https://lijun.in/tasks/debug-application-cluster/debug-service/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://lijun.in/tasks/debug-application-cluster/debug-service/</guid>
      <description>å¯¹äºæ–°å®‰è£…çš„ Kubernetesï¼Œç»å¸¸å‡ºç°çš„ä¸€ä¸ªé—®é¢˜æ˜¯ Service æ²¡æœ‰æ­£å¸¸å·¥ä½œã€‚å¦‚æœæ‚¨å·²ç»è¿è¡Œäº† Deployment å¹¶åˆ›å»ºäº†ä¸€ä¸ª Serviceï¼Œä½†æ˜¯å½“æ‚¨å°è¯•è®¿é—®å®ƒæ—¶æ²¡æœ‰å¾—åˆ°å“åº”ï¼Œå¸Œæœ›è¿™ä»½æ–‡æ¡£èƒ½å¸®åŠ©æ‚¨æ‰¾å‡ºé—®é¢˜æ‰€åœ¨ã€‚
çº¦å®š åœ¨æ•´ä¸ªæ–‡æ¡£ä¸­ï¼Œæ‚¨å°†çœ‹åˆ°å„ç§å¯ä»¥è¿è¡Œçš„å‘½ä»¤ã€‚æœ‰äº›å‘½ä»¤éœ€è¦åœ¨ Pod ä¸­è¿è¡Œï¼Œæœ‰äº›å‘½ä»¤éœ€è¦åœ¨ Kubernetes Node ä¸Šè¿è¡Œï¼Œè¿˜æœ‰ä¸€äº›å‘½ä»¤å¯ä»¥åœ¨æ‚¨æ‹¥æœ‰ kubectl å’Œé›†ç¾¤å‡­è¯çš„ä»»ä½•åœ°æ–¹è¿è¡Œã€‚ä¸ºäº†æ˜ç¡®é¢„æœŸçš„æ•ˆæœï¼Œæœ¬æ–‡æ¡£å°†ä½¿ç”¨ä»¥ä¸‹çº¦å®šã€‚
å¦‚æœå‘½ä»¤ &amp;ldquo;COMMAND&amp;rdquo; æœŸæœ›åœ¨ Pod ä¸­è¿è¡Œï¼Œå¹¶ä¸”äº§ç”Ÿ &amp;ldquo;OUTPUT&amp;rdquo;ï¼š
u@pod$ COMMAND OUTPUT å¦‚æœå‘½ä»¤ &amp;ldquo;COMMAND&amp;rdquo; æœŸæœ›åœ¨ Node ä¸Šè¿è¡Œï¼Œå¹¶ä¸”äº§ç”Ÿ &amp;ldquo;OUTPUT&amp;rdquo;ï¼š
u@node$ COMMAND OUTPUT å¦‚æœå‘½ä»¤æ˜¯ &amp;ldquo;kubectl ARGS&amp;rdquo;ï¼š
$ kubectl ARGS OUTPUT åœ¨ pod ä¸­è¿è¡Œå‘½ä»¤ å¯¹äºè¿™é‡Œçš„è®¸å¤šæ­¥éª¤ï¼Œæ‚¨å¯èƒ½å¸Œæœ›çŸ¥é“è¿è¡Œåœ¨é›†ç¾¤ä¸­çš„ Pod çœ‹èµ·æ¥æ˜¯ä»€ä¹ˆæ ·çš„ã€‚æœ€ç®€å•çš„æ–¹æ³•æ˜¯è¿è¡Œä¸€ä¸ªäº¤äº’å¼çš„ busybox Podï¼š
$ kubectl run -it --rm --restart=Never busybox --image=busybox sh å¦‚æœä½ æ²¡æœ‰çœ‹åˆ°å‘½ä»¤æç¤ºç¬¦ï¼Œè¯·å°è¯•æŒ‰ Enter é”®ã€‚ / # å¦‚æœæ‚¨å·²ç»æœ‰äº†æ‚¨å–œæ¬¢ä½¿ç”¨çš„æ­£åœ¨è¿è¡Œçš„ Podï¼Œåˆ™å¯ä»¥è¿è¡Œä¸€ä¸‹å‘½ä»¤å»ä½¿ç”¨ï¼š
$ kubectl exec &amp;lt;POD-NAME&amp;gt; -c &amp;lt;CONTAINER-NAME&amp;gt; -- &amp;lt;COMMAND&amp;gt; è®¾ç½® ä¸ºäº†å®Œæˆæœ¬æ¬¡æ¼”ç»ƒçš„ç›®çš„ï¼Œæˆ‘ä»¬å…ˆè¿è¡Œå‡ ä¸ª Podã€‚å› ä¸ºå¯èƒ½æ­£åœ¨è°ƒè¯•æ‚¨è‡ªå·±çš„ Serviceï¼Œæ‰€ä»¥ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨è‡ªå·±çš„è¯¦ç»†ä¿¡æ¯è¿›è¡Œæ›¿æ¢ï¼Œæˆ–è€…ï¼Œæ‚¨ä¹Ÿå¯ä»¥è·Ÿéšå¹¶å¼€å§‹ä¸‹é¢çš„æ­¥éª¤æ¥è·å¾—ç¬¬äºŒä¸ªæ•°æ®ç‚¹ã€‚</description>
    </item>
    
    <item>
      <title>è°ƒè¯•StatefulSet</title>
      <link>https://lijun.in/tasks/debug-application-cluster/debug-stateful-set/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://lijun.in/tasks/debug-application-cluster/debug-stateful-set/</guid>
      <description>æ­¤ä»»åŠ¡å±•ç¤ºå¦‚ä½•è°ƒè¯•StatefulSetã€‚
. heading &amp;ldquo;prerequisites&amp;rdquo; %}}  ä½ éœ€è¦æœ‰ä¸€ä¸ªKubernetesé›†ç¾¤ï¼Œé€šè¿‡å¿…è¦çš„é…ç½®ä½¿kubectlå‘½ä»¤è¡Œå·¥å…·ä¸æ‚¨çš„é›†ç¾¤è¿›è¡Œé€šä¿¡ã€‚ ä½ åº”è¯¥æœ‰ä¸€ä¸ªè¿è¡Œä¸­çš„StatefulSetï¼Œä»¥ä¾¿ç”¨äºè°ƒè¯•ã€‚  è°ƒè¯•StatefulSet ç”±äºStatefulSetåœ¨åˆ›å»ºæ—¶è®¾ç½®äº†app=myappæ ‡ç­¾ï¼Œåˆ—å‡ºä»…å±äºè¯¥StatefulSetçš„æ‰€æœ‰podæ—¶ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š
kubectl get pods -l app=myapp å¦‚æœæ‚¨å‘ç°åˆ—å‡ºçš„ä»»ä½•Podsé•¿æ—¶é—´å¤„äºUnknown æˆ–TerminatingçŠ¶æ€ï¼Œå…³äºå¦‚ä½•å¤„ç†å®ƒä»¬çš„è¯´æ˜ä»»åŠ¡,è¯·å‚é˜…åˆ é™¤ StatefulSet Podsã€‚æ‚¨å¯ä»¥å‚è€ƒè°ƒè¯• PodsæŒ‡å—æ¥è°ƒè¯•StatefulSetä¸­çš„å„ä¸ªPodã€‚
StatefulSetsæä¾›è°ƒè¯•æœºåˆ¶ï¼Œå¯ä»¥ä½¿ç”¨æ³¨è§£æ¥æš‚åœæ‰€æœ‰æ§åˆ¶å™¨åœ¨Podä¸Šçš„æ“ä½œã€‚åœ¨ä»»ä½•StatefulSet Podä¸Šè®¾ç½®pod.alpha.kubernetes.io/initializedæ³¨è§£ä¸º&amp;quot;false&amp;quot;å°†æš‚åœ StatefulSetçš„æ‰€æœ‰æ“ä½œã€‚æš‚åœæ—¶ï¼ŒStatefulSetå°†ä¸æ‰§è¡Œä»»ä½•ä¼¸ç¼©æ“ä½œã€‚ä¸€æ—¦è°ƒè¯•é’©å­è®¾ç½®å®Œæˆåï¼Œå°±å¯ä»¥åœ¨StatefulSet podçš„å®¹å™¨å†…æ‰§è¡Œå‘½ä»¤ï¼Œè€Œä¸ä¼šé€ æˆä¼¸ç¼©æ“ä½œçš„å¹²æ‰°ã€‚æ‚¨å¯ä»¥é€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å°†æ³¨è§£è®¾ç½®ä¸º&amp;quot;false&amp;quot;ï¼š
kubectl annotate pods &amp;lt;pod-name&amp;gt; pod.alpha.kubernetes.io/initialized=&amp;#34;false&amp;#34; --overwrite å½“æ³¨è§£è®¾ç½®ä¸º&amp;quot;false&amp;quot;æ—¶ï¼ŒStatefulSetåœ¨å…¶Podså˜å¾—ä¸å¥åº·æˆ–ä¸å¯ç”¨æ—¶å°†ä¸ä¼šå“åº”ã€‚StatefulSetä¸ä¼šåˆ›å»ºå‰¯æœ¬Podç›´åˆ°æ¯ä¸ªPodä¸Šåˆ é™¤æ³¨è§£æˆ–å°†æ³¨è§£è®¾ç½®ä¸º&amp;quot;true&amp;quot;ã€‚
é€æ­¥åˆå§‹åŒ– åˆ›å»ºStatefulSetä¹‹å‰ï¼Œæ‚¨å¯ä»¥é€šè¿‡ä½¿ç”¨å’Œä¸Šæ–‡ç›¸åŒçš„æ³¨è§£ï¼Œå³å°†yamlæ–‡ä»¶ä¸­.spec.template.metadata.annotationsé‡Œçš„pod.alpha.kubernetes.io/initializedå­—æ®µè®¾ç½®ä¸º&amp;quot;false&amp;quot;ï¼Œå¯¹ç«æ€æ¡ä»¶çš„StatefulSetè¿›è¡Œè°ƒè¯•ã€‚
apiVersion: apps/v1beta1 kind: StatefulSet metadata: name: my-app spec: serviceName: &amp;#34;my-app&amp;#34; replicas: 3 template: metadata: labels: app: my-app annotations: pod.alpha.kubernetes.io/initialized: &amp;#34;false&amp;#34; ... ... ... è®¾ç½®æ³¨è§£åï¼Œå¦‚æœåˆ›å»ºäº†StatefulSetï¼Œæ‚¨å¯ä»¥ç­‰å¾…æ¯ä¸ªPodæ¥éªŒè¯å®ƒæ˜¯å¦æ­£ç¡®åˆå§‹åŒ–ã€‚StatefulSetå°†ä¸ä¼šåˆ›å»ºä»»ä½•åç»­çš„Podsï¼Œç›´åˆ°åœ¨å·²ç»åˆ›å»ºçš„æ¯ä¸ªPodä¸Šå°†è°ƒè¯•æ³¨è§£è®¾ç½®ä¸º&amp;quot;true&amp;quot; (æˆ–åˆ é™¤)ã€‚ æ‚¨å¯ä»¥é€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å°†æ³¨è§£è®¾ç½®ä¸º&amp;quot;true&amp;quot;ï¼š
kubectl annotate pods &amp;lt;pod-name&amp;gt; pod.alpha.kubernetes.io/initialized=&amp;#34;true&amp;#34; --overwrite . heading &amp;ldquo;whatsnext&amp;rdquo; %}} ç‚¹å‡»é“¾æ¥è°ƒè¯•init-containerï¼Œäº†è§£æ›´å¤šä¿¡æ¯ã€‚</description>
    </item>
    
    <item>
      <title>èµ„æºæŒ‡æ ‡ç®¡é“</title>
      <link>https://lijun.in/tasks/debug-application-cluster/resource-metrics-pipeline/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://lijun.in/tasks/debug-application-cluster/resource-metrics-pipeline/</guid>
      <description>ä» Kubernetes 1.8å¼€å§‹ï¼Œèµ„æºä½¿ç”¨æŒ‡æ ‡ï¼Œä¾‹å¦‚å®¹å™¨ CPU å’Œå†…å­˜ä½¿ç”¨ç‡ï¼Œå¯é€šè¿‡ Metrics API åœ¨ Kubernetes ä¸­è·å¾—ã€‚è¿™äº›æŒ‡æ ‡å¯ä»¥ç›´æ¥è¢«ç”¨æˆ·è®¿é—®ï¼Œæ¯”å¦‚ä½¿ç”¨kubectl topå‘½ä»¤è¡Œï¼Œæˆ–è€…è¿™äº›æŒ‡æ ‡ç”±é›†ç¾¤ä¸­çš„æ§åˆ¶å™¨ä½¿ç”¨ï¼Œä¾‹å¦‚ï¼ŒHorizontal Pod Autoscalerï¼Œä½¿ç”¨è¿™äº›æŒ‡æ ‡æ¥åšå†³ç­–ã€‚
Metrics API é€šè¿‡ Metrics APIï¼Œæ‚¨å¯ä»¥è·å¾—æŒ‡å®šèŠ‚ç‚¹æˆ– pod å½“å‰ä½¿ç”¨çš„èµ„æºé‡ã€‚æ­¤ API ä¸å­˜å‚¨æŒ‡æ ‡å€¼ï¼Œå› æ­¤æƒ³è¦è·å–æŸä¸ªæŒ‡å®šèŠ‚ç‚¹10åˆ†é’Ÿå‰çš„èµ„æºä½¿ç”¨é‡æ˜¯ä¸å¯èƒ½çš„ã€‚
æ­¤ API ä¸å…¶ä»– API æ²¡æœ‰åŒºåˆ«ï¼š
 æ­¤ API å’Œå…¶å®ƒ Kubernetes API ä¸€èµ·ä½äºåŒä¸€ç«¯ç‚¹ï¼ˆendpointï¼‰ä¹‹ä¸‹ï¼Œæ˜¯å¯å‘ç°çš„ï¼Œè·¯å¾„ä¸º/apis/metrics.k8s.io/ å®ƒæä¾›ç›¸åŒçš„å®‰å…¨æ€§ã€å¯æ‰©å±•æ€§å’Œå¯é æ€§ä¿è¯  Metrics API åœ¨k8s.io/metrics ä»“åº“ä¸­å®šä¹‰ã€‚æ‚¨å¯ä»¥åœ¨é‚£é‡Œæ‰¾åˆ°æœ‰å…³ Metrics API çš„æ›´å¤šä¿¡æ¯ã€‚
. note &amp;gt;}} Metrics API éœ€è¦åœ¨é›†ç¾¤ä¸­éƒ¨ç½² Metrics Serverã€‚å¦åˆ™å®ƒå°†ä¸å¯ç”¨ã€‚ . /note &amp;gt;}}
Metrics Server Metrics Serveræ˜¯é›†ç¾¤èŒƒå›´èµ„æºä½¿ç”¨æ•°æ®çš„èšåˆå™¨ã€‚ ä» Kubernetes 1.8å¼€å§‹ï¼Œå®ƒä½œä¸º Deployment å¯¹è±¡ï¼Œè¢«é»˜è®¤éƒ¨ç½²åœ¨ç”±kube-up.shè„šæœ¬åˆ›å»ºçš„é›†ç¾¤ä¸­ã€‚ å¦‚æœæ‚¨ä½¿ç”¨ä¸åŒçš„ Kubernetes å®‰è£…æ–¹æ³•ï¼Œåˆ™å¯ä»¥ä½¿ç”¨æä¾›çš„deployment yamlsæ¥éƒ¨ç½²ã€‚å®ƒåœ¨ Kubernetes 1.7+ä¸­å¾—åˆ°æ”¯æŒï¼ˆè¯¦è§ä¸‹æ–‡ï¼‰ã€‚
Metric server ä»æ¯ä¸ªèŠ‚ç‚¹ä¸Šçš„ Kubelet å…¬å¼€çš„ Summary API ä¸­é‡‡é›†æŒ‡æ ‡ä¿¡æ¯ã€‚</description>
    </item>
    
    <item>
      <title>èµ„æºç›‘æ§å·¥å…·</title>
      <link>https://lijun.in/tasks/debug-application-cluster/resource-usage-monitoring/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://lijun.in/tasks/debug-application-cluster/resource-usage-monitoring/</guid>
      <description>è¦æ‰©å±•åº”ç”¨ç¨‹åºå¹¶æä¾›å¯é çš„æœåŠ¡ï¼Œæ‚¨éœ€è¦äº†è§£åº”ç”¨ç¨‹åºåœ¨éƒ¨ç½²æ—¶çš„è¡Œä¸ºã€‚ æ‚¨å¯ä»¥é€šè¿‡æ£€æµ‹å®¹å™¨æ£€æŸ¥ Kubernetes é›†ç¾¤ä¸­çš„åº”ç”¨ç¨‹åºæ€§èƒ½ï¼Œpods, æœåŠ¡å’Œæ•´ä¸ªé›†ç¾¤çš„ç‰¹å¾ã€‚ Kubernetes åœ¨æ¯ä¸ªçº§åˆ«ä¸Šæä¾›æœ‰å…³åº”ç”¨ç¨‹åºèµ„æºä½¿ç”¨æƒ…å†µçš„è¯¦ç»†ä¿¡æ¯ã€‚ æ­¤ä¿¡æ¯ä½¿æ‚¨å¯ä»¥è¯„ä¼°åº”ç”¨ç¨‹åºçš„æ€§èƒ½ï¼Œä»¥åŠåœ¨ä½•å¤„å¯ä»¥æ¶ˆé™¤ç“¶é¢ˆä»¥æé«˜æ•´ä½“æ€§èƒ½ã€‚
åœ¨ Kubernetes ä¸­ï¼Œåº”ç”¨ç¨‹åºç›‘æ§ä¸ä¾èµ–å•ä¸ªç›‘æ§è§£å†³æ–¹æ¡ˆã€‚ åœ¨æ–°é›†ç¾¤ä¸Šï¼Œæ‚¨å¯ä»¥ä½¿ç”¨èµ„æºåº¦é‡æˆ–å®Œæ•´åº¦é‡ç®¡é“æ¥æ”¶é›†ç›‘è§†ç»Ÿè®¡ä¿¡æ¯ã€‚
èµ„æºåº¦é‡ç®¡é“ èµ„æºæŒ‡æ ‡ç®¡é“æä¾›äº†ä¸€ç»„ä¸é›†ç¾¤ç»„ä»¶ï¼Œä¾‹å¦‚[Horizontal Pod Autoscaler]æ§åˆ¶å™¨(/docs/tasks/run-application/horizontal-pod-autoscale)ï¼Œä»¥åŠ kubectl top å®ç”¨ç¨‹åºç›¸å…³çš„æœ‰é™åº¦é‡ã€‚ è¿™äº›æŒ‡æ ‡æ˜¯ç”±è½»é‡çº§çš„ã€çŸ­æœŸå†…å­˜åº¦é‡æœåŠ¡å™¨æ”¶é›†çš„ï¼Œé€šè¿‡ metrics.k8s.io å…¬å¼€ã€‚
åº¦é‡æœåŠ¡å™¨å‘ç°é›†ç¾¤ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œå¹¶ä¸”æŸ¥è¯¢æ¯ä¸ªèŠ‚ç‚¹çš„kubeletä»¥è·å– CPU å’Œå†…å­˜ä½¿ç”¨æƒ…å†µã€‚ Kubelet å……å½“ Kubernetes ä¸»èŠ‚ç‚¹ä¸èŠ‚ç‚¹ä¹‹é—´çš„æ¡¥æ¢ï¼Œç®¡ç†æœºå™¨ä¸Šè¿è¡Œçš„ Pod å’Œå®¹å™¨ã€‚ kubelet å°†æ¯ä¸ª pod è½¬æ¢ä¸ºå…¶ç»„æˆçš„å®¹å™¨ï¼Œå¹¶åœ¨å®¹å™¨è¿è¡Œæ—¶é€šè¿‡å®¹å™¨è¿è¡Œæ—¶ç•Œé¢è·å–å„ä¸ªå®¹å™¨ä½¿ç”¨æƒ…å†µç»Ÿè®¡ä¿¡æ¯ã€‚ kubelet ä»é›†æˆçš„ cAdvisor è·å–æ­¤ä¿¡æ¯ï¼Œä»¥è¿›è¡Œæ—§å¼ Docker é›†æˆã€‚ ç„¶åï¼Œå®ƒé€šè¿‡ metrics-server Resource Metrics API å…¬å¼€èšåˆçš„ pod èµ„æºä½¿ç”¨æƒ…å†µç»Ÿè®¡ä¿¡æ¯ã€‚ è¯¥ API åœ¨ kubelet çš„ç»è¿‡èº«ä»½éªŒè¯å’Œåªè¯»çš„ç«¯å£ä¸Šçš„/metrics/resource/v1beta1ä¸­æä¾›ã€‚
å®Œæ•´åº¦é‡ç®¡é“ ä¸€ä¸ªå®Œæ•´åº¦é‡ç®¡é“å¯ä»¥è®©æ‚¨è®¿é—®æ›´ä¸°å¯Œçš„åº¦é‡ã€‚ Kubernetes è¿˜å¯ä»¥æ ¹æ®é›†ç¾¤çš„å½“å‰çŠ¶æ€ï¼Œä½¿ç”¨ Pod æ°´å¹³è‡ªåŠ¨æ‰©ç¼©å™¨ç­‰æœºåˆ¶ï¼Œé€šè¿‡è‡ªåŠ¨è°ƒç”¨æ‰©å±•æˆ–è°ƒæ•´é›†ç¾¤æ¥å“åº”è¿™äº›åº¦é‡ã€‚ ç›‘æ§ç®¡é“ä» kubelet è·å–åº¦é‡ï¼Œç„¶åé€šè¿‡é€‚é…å™¨å°†å®ƒä»¬å…¬å¼€ç»™ Kubernetesï¼Œæ–¹æ³•æ˜¯å®ç° custom.metrics.k8s.io æˆ– external.metrics.k8s.io APIã€‚
Prometheusï¼Œä¸€ä¸ª CNCF é¡¹ç›®ï¼Œå¯ä»¥åŸç”Ÿç›‘æ§ Kubernetesã€èŠ‚ç‚¹å’Œ Prometheus æœ¬èº«ã€‚ å®Œæ•´åº¦é‡ç®¡é“é¡¹ç›®ä¸å±äº CNCF çš„ä¸€éƒ¨åˆ†ï¼Œä¸åœ¨ Kubernetes æ–‡æ¡£çš„èŒƒå›´ä¹‹å†…ã€‚</description>
    </item>
    
    <item>
      <title>é›†ç¾¤æ•…éšœæ’æŸ¥</title>
      <link>https://lijun.in/tasks/debug-application-cluster/debug-cluster/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://lijun.in/tasks/debug-application-cluster/debug-cluster/</guid>
      <description>æœ¬ç¯‡æ–‡æ¡£æ˜¯ä»‹ç»é›†ç¾¤æ•…éšœæ’æŸ¥çš„ï¼›æˆ‘ä»¬å‡è®¾å¯¹äºä½ ç¢°åˆ°çš„é—®é¢˜ï¼Œä½ å·²ç»æ’é™¤äº†æ˜¯ç”±åº”ç”¨ç¨‹åºé€ æˆçš„ã€‚ å¯¹äºåº”ç”¨çš„è°ƒè¯•ï¼Œè¯·å‚é˜…åº”ç”¨æ•…éšœæ’æŸ¥æŒ‡å—ã€‚ ä½ ä¹Ÿå¯ä»¥è®¿é—®troubleshooting documentæ¥è·å–æ›´å¤šçš„ä¿¡æ¯ã€‚
æ˜¾ç¤ºå‡ºé›†ç¾¤çš„èŠ‚ç‚¹åˆ—è¡¨ è°ƒè¯•çš„ç¬¬ä¸€æ­¥æ˜¯æŸ¥çœ‹æ‰€æœ‰çš„èŠ‚ç‚¹æ˜¯å¦éƒ½æ­£ç¡®çš„æ³¨å†Œã€‚
è¿è¡Œ
kubectl get nodes æ¥ä¸‹æ¥ï¼ŒéªŒè¯ä½ çš„æ‰€æœ‰èŠ‚ç‚¹éƒ½èƒ½å¤Ÿæ˜¾ç¤ºå‡ºæ¥ï¼Œå¹¶ä¸”éƒ½å¤„äºReadyçŠ¶æ€ã€‚
æŸ¥çœ‹logs ç°åœ¨ï¼ŒæŒ–æ˜å‡ºé›†ç¾¤æ›´æ·±å±‚çš„ä¿¡æ¯å°±éœ€è¦ç™»å½•åˆ°ç›¸å…³çš„æœºå™¨ä¸Šã€‚ä¸‹é¢æ˜¯ç›¸å…³logæ–‡ä»¶æ‰€åœ¨çš„ä½ç½®ã€‚ (æ³¨æ„ï¼Œå¯¹äºåŸºäºsystemdçš„ç³»ç»Ÿï¼Œä½ å¯èƒ½éœ€è¦ä½¿ç”¨journalctl)
Master  /var/log/kube-apiserver.log - API Server, æä¾›APIæœåŠ¡ /var/log/kube-scheduler.log - Scheduler, è´Ÿè´£è°ƒåº¦å†³ç­– /var/log/kube-controller-manager.log - ç®¡ç†replication controllersçš„æ§åˆ¶å™¨  Worker Nodes  /var/log/kubelet.log - Kubelet, ç®¡æ§èŠ‚ç‚¹ä¸Šè¿è¡Œçš„å®¹å™¨ /var/log/kube-proxy.log - Kube Proxy, è´Ÿè´£æœåŠ¡çš„è´Ÿè½½å‡è¡¡  é›†ç¾¤æ•…éšœæ¨¡å¼çš„æ¦‚è¿° ä¸‹é¢æ˜¯ä¸€ä¸ªä¸å®Œæ•´çš„åˆ—è¡¨ï¼Œåˆ—ä¸¾äº†ä¸€äº›å¯èƒ½å‡ºé”™çš„åœºæ™¯ï¼Œä»¥åŠé€šè¿‡è°ƒæ•´é›†ç¾¤é…ç½®æ¥è§£å†³ç›¸å…³é—®é¢˜çš„æ–¹æ³•ã€‚
æ ¹æœ¬åŸå› ï¼š
 VM(s)å…³æœº é›†ç¾¤ä¹‹é—´ï¼Œæˆ–è€…é›†ç¾¤å’Œç”¨æˆ·ä¹‹é—´ç½‘ç»œåˆ†è£‚ Kubernetesè½¯ä»¶æœ¬èº«å´©æºƒäº† æ•°æ®ä¸¢å¤±æˆ–è€…æŒä¹…åŒ–å­˜å‚¨ä¸å¯ç”¨(å¦‚:GCE PD æˆ– AWS EBSå·) æ“ä½œé”™è¯¯ï¼Œå¦‚ï¼šKubernetesæˆ–è€…åº”ç”¨ç¨‹åºé…ç½®é”™è¯¯  å…·ä½“æƒ…å†µ:
  Apiserveræ‰€åœ¨çš„VMå…³æœºæˆ–è€…apiserverå´©æºƒ
 ç»“æœ  ä¸èƒ½åœæ­¢ï¼Œæ›´æ–°ï¼Œæˆ–è€…å¯åŠ¨æ–°çš„podsï¼Œservicesï¼Œreplication controller ç°æœ‰çš„podså’Œservicesåœ¨ä¸ä¾èµ–Kubernetes APIçš„æƒ…å†µä¸‹åº”è¯¥èƒ½ç»§ç»­æ­£å¸¸å·¥ä½œ      Apiserver åç«¯å­˜å‚¨ä¸¢å¤±</description>
    </item>
    
  </channel>
</rss>