<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>ğŸ˜ - è¿è¡Œåº”ç”¨ on Hugo ä¸»é¢˜çš„ Learn æ–‡æ¡£</title>
    <link>https://lijun.in/tasks/run-application/</link>
    <description>Recent content in ğŸ˜ - è¿è¡Œåº”ç”¨ on Hugo ä¸»é¢˜çš„ Learn æ–‡æ¡£</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-US</language>
    
	<atom:link href="https://lijun.in/tasks/run-application/index.xml" rel="self" type="application/rss+xml" />
    
    
    <item>
      <title>è¿è¡Œä¸€ä¸ªæœ‰çŠ¶æ€çš„åº”ç”¨ç¨‹åº</title>
      <link>https://lijun.in/tasks/run-application/run-replicated-stateful-application/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://lijun.in/tasks/run-application/run-replicated-stateful-application/</guid>
      <description>è¯¥é¡µé¢æ˜¾ç¤ºå¦‚ä½•ä½¿ç”¨StatefulSet æ§åˆ¶å™¨å»è¿è¡Œä¸€ä¸ªæœ‰çŠ¶æ€çš„åº”ç”¨ç¨‹åºã€‚æ­¤ä¾‹æ˜¯ä¸€ä¸»å¤šä»çš„ MySQL é›†ç¾¤ã€‚
è¯·æ³¨æ„ è¿™ä¸æ˜¯ç”Ÿäº§é…ç½®ã€‚ é‡ç‚¹æ˜¯ï¼Œ MySQL è®¾ç½®ä¿ç•™åœ¨ä¸å®‰å…¨çš„é»˜è®¤å€¼ä¸Šï¼Œä½¿é‡ç‚¹æ”¾åœ¨ Kubernetes ä¸­è¿è¡Œæœ‰çŠ¶æ€åº”ç”¨ç¨‹åºçš„å¸¸è§„æ¨¡å¼ã€‚
. heading &amp;ldquo;prerequisites&amp;rdquo; %}}  . include &amp;ldquo;task-tutorial-prereqs.md&amp;rdquo; &amp;gt;}} . version-check &amp;gt;}} . include &amp;ldquo;default-storage-class-prereqs.md&amp;rdquo; &amp;gt;}} æœ¬æ•™ç¨‹å‡å®šæ‚¨ç†Ÿæ‚‰ PersistentVolumes ä¸ StatefulSets, ä»¥åŠå…¶ä»–æ ¸å¿ƒæ¦‚å¿µï¼Œä¾‹å¦‚Pods, Services, ä¸ ConfigMaps. ç†Ÿæ‚‰ MySQL ä¼šæœ‰æ‰€å¸®åŠ©ï¼Œä½†æ˜¯æœ¬æ•™ç¨‹æ—¨åœ¨ä»‹ç»å¯¹å…¶ä»–ç³»ç»Ÿåº”è¯¥æœ‰ç”¨çš„å¸¸è§„æ¨¡å¼ã€‚  . heading &amp;ldquo;objectives&amp;rdquo; %}}  ä½¿ç”¨ StatefulSet æ§åˆ¶å™¨éƒ¨ç½²å¤åˆ¶çš„ MySQL æ‹“æ‰‘ã€‚ å‘é€ MySQL å®¢æˆ·ç«¯æµé‡ã€‚ è§‚å¯Ÿå¯¹å®•æœºçš„æŠµæŠ—åŠ›ã€‚ ç¼©æ”¾ StatefulSet çš„å¤§å°ã€‚  éƒ¨ç½² MySQL éƒ¨ç½² MySQL ç¤ºä¾‹ï¼ŒåŒ…å«ä¸€ä¸ª ConfigMapï¼Œä¸¤ä¸ª Servicesï¼Œä¸ä¸€ä¸ª StatefulSetã€‚
ConfigMap ä»ä»¥ä¸‹çš„ YAML é…ç½®æ–‡ä»¶åˆ›å»º ConfigMap ï¼š</description>
    </item>
    
    <item>
      <title>ä½¿ç”¨ kubectl patch æ›´æ–° API å¯¹è±¡</title>
      <link>https://lijun.in/tasks/run-application/update-api-object-kubectl-patch/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://lijun.in/tasks/run-application/update-api-object-kubectl-patch/</guid>
      <description>è¿™ä¸ªä»»åŠ¡å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ kubectl patch å°±åœ°æ›´æ–° API å¯¹è±¡ã€‚è¿™ä¸ªä»»åŠ¡ä¸­çš„ç»ƒä¹ æ¼”ç¤ºäº†ä¸€ä¸ªç­–ç•¥æ€§åˆå¹¶ patch å’Œä¸€ä¸ª JSON åˆå¹¶ patchã€‚
. heading &amp;ldquo;prerequisites&amp;rdquo; %}} . include &amp;ldquo;task-tutorial-prereqs.md&amp;rdquo; &amp;gt;}} . version-check &amp;gt;}}
ä½¿ç”¨ç­–ç•¥åˆå¹¶ patch æ›´æ–° Deployment ä¸‹é¢æ˜¯å…·æœ‰ä¸¤ä¸ªå‰¯æœ¬çš„ Deployment çš„é…ç½®æ–‡ä»¶ã€‚æ¯ä¸ªå‰¯æœ¬æ˜¯ä¸€ä¸ª Podï¼Œæœ‰ä¸€ä¸ªå®¹å™¨ï¼š
. codenew file=&amp;quot;application/deployment-patch.yaml&amp;rdquo; &amp;gt;}}
åˆ›å»º Deploymentï¼š
kubectl create -f https://k8s.io/examples/application/deployment-patch.yaml æŸ¥çœ‹ä¸ Deployment ç›¸å…³çš„ Podï¼š
kubectl get pods è¾“å‡ºæ˜¾ç¤º Deployment æœ‰ä¸¤ä¸ª Podã€‚1/1 è¡¨ç¤ºæ¯ä¸ª Pod æœ‰ä¸€ä¸ªå®¹å™¨:
NAME READY STATUS RESTARTS AGE patch-demo-28633765-670qr 1/1 Running 0 23s patch-demo-28633765-j5qs3 1/1 Running 0 23s æŠŠè¿è¡Œçš„ Pod çš„åå­—è®°ä¸‹æ¥ã€‚ç¨åï¼Œæ‚¨å°†çœ‹åˆ°è¿™äº› Pod è¢«ç»ˆæ­¢å¹¶è¢«æ–°çš„ Pod æ›¿æ¢ã€‚</description>
    </item>
    
    <item>
      <title>åˆ é™¤ StatefulSet</title>
      <link>https://lijun.in/tasks/run-application/delete-stateful-set/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://lijun.in/tasks/run-application/delete-stateful-set/</guid>
      <description>æœ¬æ–‡ä»‹ç»å¦‚ä½•åˆ é™¤ StatefulSetã€‚
. heading &amp;ldquo;prerequisites&amp;rdquo; %}}  æœ¬æ–‡å‡è®¾åœ¨æ‚¨çš„é›†ç¾¤ä¸Šå·²ç»è¿è¡Œäº†ç”± StatefulSet åˆ›å»ºçš„åº”ç”¨ã€‚  åˆ é™¤ StatefulSet æ‚¨å¯ä»¥åƒåˆ é™¤ Kubernetes ä¸­çš„å…¶ä»–èµ„æºä¸€æ ·åˆ é™¤ StatefulSetï¼šä½¿ç”¨ kubectl delete å‘½ä»¤ï¼Œå¹¶æŒ‰æ–‡ä»¶æˆ–è€…åå­—æŒ‡å®š StatefulSetã€‚
kubectl delete -f &amp;lt;file.yaml&amp;gt; kubectl delete statefulsets &amp;lt;statefulset-name&amp;gt; åˆ é™¤ StatefulSet ä¹‹åï¼Œæ‚¨å¯èƒ½éœ€è¦å•ç‹¬åˆ é™¤å…³è”çš„æ— å¤´æœåŠ¡ã€‚
kubectl delete service &amp;lt;service-name&amp;gt; é€šè¿‡ kubectl åˆ é™¤ StatefulSet ä¼šå°†å…¶ç¼©å®¹ä¸º0ï¼Œå› æ­¤åˆ é™¤å±äºå®ƒçš„æ‰€æœ‰podsã€‚ å¦‚æœæ‚¨åªæƒ³åˆ é™¤ StatefulSet è€Œä¸åˆ é™¤ podsï¼Œä½¿ç”¨ --cascade=falseã€‚
kubectl delete -f &amp;lt;file.yaml&amp;gt; --cascade=false é€šè¿‡å°† --cascade=false ä¼ é€’ç»™ kubectl deleteï¼Œåœ¨åˆ é™¤ StatefulSet å¯¹è±¡ä¹‹åï¼ŒStatefulSet ç®¡ç†çš„ pods ä¼šè¢«ä¿ç•™ä¸‹æ¥ã€‚å¦‚æœ pods æœ‰ä¸€ä¸ªæ ‡ç­¾ app=myappï¼Œåˆ™å¯ä»¥æŒ‰ç…§å¦‚ä¸‹æ–¹å¼åˆ é™¤å®ƒä»¬ï¼š
kubectl delete pods -l app=myapp Persistent Volumes åˆ é™¤ StatefulSet ç®¡ç†çš„ pods å¹¶ä¸ä¼šåˆ é™¤å…³è”çš„å·ã€‚è¿™æ˜¯ä¸ºäº†ç¡®ä¿æ‚¨æœ‰æœºä¼šåœ¨åˆ é™¤å·ä¹‹å‰ä»å·ä¸­å¤åˆ¶æ•°æ®ã€‚åœ¨podsç¦»å¼€ç»ˆæ­¢çŠ¶æ€ååˆ é™¤ PVC å¯èƒ½ä¼šè§¦å‘åˆ é™¤æ”¯æŒçš„ Persistent Volumesï¼Œå…·ä½“å–å†³äºå­˜å‚¨ç±»å’Œå›æ”¶ç­–ç•¥ã€‚å£°æ˜åˆ é™¤åï¼Œæ‚¨æ°¸è¿œä¸åº”è¯¥å‡è®¾èƒ½å¤Ÿè®¿é—®å·ã€‚</description>
    </item>
    
    <item>
      <title>å¼ºåˆ¶åˆ é™¤ StatefulSet ç±»å‹çš„ Pods</title>
      <link>https://lijun.in/tasks/run-application/force-delete-stateful-set-pod/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://lijun.in/tasks/run-application/force-delete-stateful-set-pod/</guid>
      <description>æœ¬æ–‡ä»‹ç»äº†å¦‚ä½•åˆ é™¤ StatefulSet ç®¡ç†çš„éƒ¨åˆ† podsï¼Œå¹¶ä¸”è§£é‡Šäº†è¿™æ ·æ“ä½œæ—¶éœ€è¦è®°ä½çš„æ³¨æ„äº‹é¡¹ã€‚
. heading &amp;ldquo;prerequisites&amp;rdquo; %}}  è¿™æ˜¯ä¸€é¡¹ç›¸å½“é«˜çº§çš„ä»»åŠ¡ï¼Œå¹¶ä¸”å¯èƒ½ä¼šè¿å StatefulSet å›ºæœ‰çš„æŸäº›å±æ€§ã€‚ ç»§ç»­ä»»åŠ¡ä¹‹å‰ï¼Œè¯·ç†Ÿæ‚‰ä¸‹é¢åˆ—ä¸¾çš„æ³¨æ„äº‹é¡¹ã€‚  StatefulSet æ³¨æ„äº‹é¡¹ åœ¨ StatefulSet çš„æ­£å¸¸æ“ä½œä¸­ï¼Œæ°¸è¿œä¸éœ€è¦å¼ºåˆ¶åˆ é™¤ StatefulSet ç®¡ç†çš„ podã€‚StatefulSet æ§åˆ¶å™¨è´Ÿè´£åˆ›å»ºï¼Œæ‰©å®¹å’Œåˆ é™¤ StatefulSet ç®¡ç†çš„ podsã€‚å®ƒå°è¯•ç¡®ä¿ä»åºå· 0 åˆ° N-1 æŒ‡å®šæ•°é‡çš„ pods å¤„äºæ´»åŠ¨çŠ¶æ€å¹¶å‡†å¤‡å°±ç»ªã€‚StatefulSet ç¡®ä¿åœ¨ä»»ä½•æ—¶å€™ï¼Œé›†ç¾¤ä¸­æœ€å¤šåªæœ‰ä¸€ä¸ªå…·æœ‰ç»™å®šæ ‡è¯†çš„ podã€‚è¿™å°±æ˜¯æ‰€è°“çš„ç”± StatefulSet æä¾›çš„æœ€å¤šä¸€ä¸ªçš„è¯­ä¹‰ã€‚
åº”è°¨æ…è¿›è¡Œæ‰‹åŠ¨å¼ºåˆ¶åˆ é™¤æ“ä½œï¼Œå› ä¸ºå®ƒå¯èƒ½ä¼šè¿å StatefulSet å›ºæœ‰çš„è‡³å¤šä¸€ä¸ªçš„è¯­ä¹‰ã€‚StatefulSets å¯ç”¨äºè¿è¡Œåˆ†å¸ƒå¼å’Œé›†ç¾¤çº§çš„åº”ç”¨ï¼Œè¿™äº›åº”ç”¨éœ€è¦ç¨³å®šçš„ç½‘ç»œæ ‡è¯†å’Œå¯é çš„å­˜å‚¨ã€‚è¿™äº›åº”ç”¨é€šå¸¸é…ç½®ä¸ºå…·æœ‰å›ºå®šæ ‡è¯†å›ºå®šæ•°é‡çš„æˆå‘˜é›†åˆã€‚å…·æœ‰ç›¸åŒèº«ä»½çš„å¤šä¸ªæˆå‘˜å¯èƒ½æ˜¯ç¾éš¾æ€§çš„ï¼Œå¹¶ä¸”å¯èƒ½å¯¼è‡´æ•°æ®ä¸¢å¤± (e.g. åŸºäº quorum ç³»ç»Ÿä¸­çš„è„‘è£‚åœºæ™¯)ã€‚
åˆ é™¤ Pods æ‚¨å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ‰§è¡Œä¼˜é›…åœ°åˆ é™¤ pod:
kubectl delete pods &amp;lt;pod&amp;gt; ä¸ºäº†ä½¿ä¸Šé¢çš„æ–¹æ³•èƒ½å¤Ÿæ­£å¸¸ç»ˆæ­¢ï¼ŒPod ä¸€å®šä¸èƒ½è®¾ç½® pod.Spec.TerminationGracePeriodSeconds ä¸º 0ã€‚å°† pod.Spec.TerminationGracePeriodSeconds è®¾ç½®ä¸º 0s çš„åšæ³•æ˜¯ä¸å®‰å…¨çš„ï¼Œå¼ºçƒˆå»ºè®® StatefulSet ç±»å‹çš„ pods ä¸è¦ä½¿ç”¨ã€‚ä¼˜é›…åˆ é™¤æ˜¯å®‰å…¨çš„ï¼Œå¹¶ä¸”ä¼šåœ¨ kubelet ä» apiserver ä¸­åˆ é™¤åç§°ä¹‹å‰ç¡®ä¿ ä¼˜é›…åœ°å…³é—­ pod ã€‚</description>
    </item>
    
    <item>
      <title>åŸºäºReplication Controlleræ‰§è¡Œæ»šåŠ¨å‡çº§</title>
      <link>https://lijun.in/tasks/run-application/rolling-update-replication-controller/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://lijun.in/tasks/run-application/rolling-update-replication-controller/</guid>
      <description>æ¦‚è¿° æ³¨: åˆ›å»ºå‰¯æœ¬åº”ç”¨çš„é¦–é€‰æ–¹æ³•æ˜¯ä½¿ç”¨[Deployment](/docs/api-reference/. param &amp;ldquo;version&amp;rdquo; &amp;gt;}}/#deployment-v1beta1-apps)ï¼ŒDeploymentä½¿ç”¨[ReplicaSet](/docs/api-reference/. param &amp;ldquo;version&amp;rdquo; &amp;gt;}}/#replicaset-v1beta1-extensions)æ¥è¿›è¡Œå‰¯æœ¬æ§åˆ¶ã€‚ æ›´å¤šä¿¡æ¯, æŸ¥çœ‹ä½¿ç”¨Deploymentè¿è¡Œä¸€ä¸ªæ— çŠ¶æ€åº”ç”¨ã€‚
ä¸ºäº†åœ¨æ›´æ–°æœåŠ¡çš„åŒæ—¶ä¸ä¸­æ–­ä¸šåŠ¡ï¼Œ kubectl æ”¯æŒ&amp;lsquo;æ»šåŠ¨æ›´æ–°&amp;rsquo;ï¼Œå®ƒä¸€æ¬¡æ›´æ–°ä¸€ä¸ªpodï¼Œè€Œä¸æ˜¯åŒæ—¶åœæ­¢æ•´ä¸ªæœåŠ¡ã€‚ æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… æ»šåŠ¨æ›´æ–°è®¾è®¡æ–‡æ¡£ å’Œ æ»šåŠ¨æ›´æ–°ç¤ºä¾‹ã€‚
è¯·æ³¨æ„ï¼Œ kubectl rolling-update ä»…æ”¯æŒReplication Controllersã€‚ ä½†æ˜¯ï¼Œå¦‚æœä½¿ç”¨Replication Controllerséƒ¨ç½²åº”ç”¨ï¼Œè¯·è€ƒè™‘å°†å…¶åˆ‡æ¢åˆ°Deployments. Deploymentæ˜¯ä¸€ç§è¢«æ¨èä½¿ç”¨çš„æ›´é«˜çº§åˆ«çš„æ§åˆ¶å™¨ï¼Œå®ƒå¯ä»¥å¯¹åº”ç”¨è¿›è¡Œå£°æ˜æ€§çš„è‡ªåŠ¨æ»šåŠ¨æ›´æ–°ã€‚ å¦‚æœæ‚¨ä»ç„¶å¸Œæœ›ä¿ç•™æ‚¨çš„Replication Controllerså¹¶ä½¿ç”¨ kubectl rolling-updateè¿›è¡Œæ»šåŠ¨æ›´æ–°ï¼Œ è¯·ç»§ç»­å¾€ä¸‹é˜…è¯»ï¼š
æ»šåŠ¨æ›´æ–°å¯ä»¥å¯¹replication controlleræ‰€ç®¡ç†çš„Podçš„é…ç½®è¿›è¡Œå˜æ›´ï¼Œå˜æ›´å¯ä»¥é€šè¿‡ä¸€ä¸ªæ–°çš„é…ç½®æ–‡ä»¶æ¥è¿›è¡Œï¼Œæˆ–è€…ï¼Œå¦‚æœåªæ›´æ–°é•œåƒï¼Œåˆ™å¯ä»¥ç›´æ¥æŒ‡å®šæ–°çš„å®¹å™¨é•œåƒã€‚
æ»šåŠ¨æ›´æ–°çš„å·¥ä½œæµç¨‹ï¼š
 é€šè¿‡æ–°çš„é…ç½®åˆ›å»ºä¸€ä¸ªreplication controller åœ¨æ–°çš„æ§åˆ¶å™¨ä¸Šå¢åŠ å‰¯æœ¬æ•°ï¼Œåœ¨æ—§çš„ä¸Šé¢å‡å°‘å‰¯æœ¬æ•°ï¼Œç›´åˆ°å‰¯æœ¬æ•°è¾¾åˆ°æœŸæœ›å€¼ åˆ é™¤ä¹‹å‰çš„replication controller  ä½¿ç”¨kubectl rolling-updateå‘½ä»¤æ¥è¿›è¡Œæ»šåŠ¨æ›´æ–°ï¼š
$ kubectl rolling-update NAME \ ([NEW_NAME] --image=IMAGE | -f FILE)  é€šè¿‡é…ç½®æ–‡ä»¶æ›´æ–° é€šè¿‡é…ç½®æ–‡ä»¶æ¥è¿›è¡Œæ»šåŠ¨æ›´æ–°ï¼Œéœ€è¦åœ¨kubectl rolling-updateå‘½ä»¤åé¢å¸¦ä¸Šæ–°çš„é…ç½®æ–‡ä»¶ï¼š
$ kubectl rolling-update NAME -f FILE  è¿™ä¸ªé…ç½®æ–‡ä»¶å¿…é¡»æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š
  æŒ‡å®šä¸åŒçš„metadata.nameå€¼
  è‡³å°‘è¦ä¿®æ”¹spec.</description>
    </item>
    
    <item>
      <title>Pod æ°´å¹³è‡ªåŠ¨ä¼¸ç¼©</title>
      <link>https://lijun.in/tasks/run-application/horizontal-pod-autoscale/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://lijun.in/tasks/run-application/horizontal-pod-autoscale/</guid>
      <description>Pod æ°´å¹³è‡ªåŠ¨ä¼¸ç¼©ï¼ˆHorizontal Pod Autoscalerï¼‰ç‰¹æ€§ï¼Œ å¯ä»¥åŸºäºCPUåˆ©ç”¨ç‡è‡ªåŠ¨ä¼¸ç¼© replication controllerã€deploymentå’Œ replica set ä¸­çš„ pod æ•°é‡ï¼Œï¼ˆé™¤äº† CPU åˆ©ç”¨ç‡ï¼‰ä¹Ÿå¯ä»¥ åŸºäºå…¶ä»–åº”ç¨‹åºæä¾›çš„åº¦é‡æŒ‡æ ‡custom metricsã€‚ pod è‡ªåŠ¨ç¼©æ”¾ä¸é€‚ç”¨äºæ— æ³•ç¼©æ”¾çš„å¯¹è±¡ï¼Œæ¯”å¦‚ DaemonSetsã€‚
Pod æ°´å¹³è‡ªåŠ¨ä¼¸ç¼©ç‰¹æ€§ç”± Kubernetes API èµ„æºå’Œæ§åˆ¶å™¨å®ç°ã€‚èµ„æºå†³å®šäº†æ§åˆ¶å™¨çš„è¡Œä¸ºã€‚ æ§åˆ¶å™¨ä¼šå‘¨æœŸæ€§çš„è·å–å¹³å‡ CPU åˆ©ç”¨ç‡ï¼Œå¹¶ä¸ç›®æ ‡å€¼ç›¸æ¯”è¾ƒåæ¥è°ƒæ•´ replication controller æˆ– deployment ä¸­çš„å‰¯æœ¬æ•°é‡ã€‚
Pod æ°´å¹³è‡ªåŠ¨ä¼¸ç¼©å·¥ä½œæœºåˆ¶ Pod æ°´å¹³è‡ªåŠ¨ä¼¸ç¼©çš„å®ç°æ˜¯ä¸€ä¸ªæ§åˆ¶å¾ªç¯ï¼Œç”± controller manager çš„ --horizontal-pod-autoscaler-sync-period å‚æ•° æŒ‡å®šå‘¨æœŸï¼ˆé»˜è®¤å€¼ä¸º15ç§’ï¼‰ã€‚
æ¯ä¸ªå‘¨æœŸå†…ï¼Œcontroller manager æ ¹æ®æ¯ä¸ª HorizontalPodAutoscaler å®šä¹‰ä¸­æŒ‡å®šçš„æŒ‡æ ‡æŸ¥è¯¢èµ„æºåˆ©ç”¨ç‡ã€‚ controller manager å¯ä»¥ä» resource metrics APIï¼ˆæ¯ä¸ªpod èµ„æºæŒ‡æ ‡ï¼‰å’Œ custom metrics APIï¼ˆå…¶ä»–æŒ‡æ ‡ï¼‰è·å–æŒ‡æ ‡ã€‚
 å¯¹äºæ¯ä¸ª pod çš„èµ„æºæŒ‡æ ‡ï¼ˆå¦‚ CPUï¼‰ï¼Œæ§åˆ¶å™¨ä»èµ„æºæŒ‡æ ‡ API ä¸­è·å–æ¯ä¸€ä¸ª HorizontalPodAutoscaler æŒ‡å®š çš„ pod çš„æŒ‡æ ‡ï¼Œç„¶åï¼Œå¦‚æœè®¾ç½®äº†ç›®æ ‡ä½¿ç”¨ç‡ï¼Œæ§åˆ¶å™¨è·å–æ¯ä¸ª pod ä¸­çš„å®¹å™¨èµ„æºä½¿ç”¨æƒ…å†µï¼Œå¹¶è®¡ç®—èµ„æºä½¿ç”¨ç‡ã€‚ å¦‚æœä½¿ç”¨åŸå§‹å€¼ï¼Œå°†ç›´æ¥ä½¿ç”¨åŸå§‹æ•°æ®ï¼ˆä¸å†è®¡ç®—ç™¾åˆ†æ¯”ï¼‰ã€‚ ç„¶åï¼Œæ§åˆ¶å™¨æ ¹æ®å¹³å‡çš„èµ„æºä½¿ç”¨ç‡æˆ–åŸå§‹å€¼è®¡ç®—å‡ºç¼©æ”¾çš„æ¯”ä¾‹ï¼Œè¿›è€Œè®¡ç®—å‡ºç›®æ ‡å‰¯æœ¬æ•°ã€‚  éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœ pod æŸäº›å®¹å™¨ä¸æ”¯æŒèµ„æºé‡‡é›†ï¼Œé‚£ä¹ˆæ§åˆ¶å™¨å°†ä¸ä¼šä½¿ç”¨è¯¥ pod çš„ CPU ä½¿ç”¨ç‡ã€‚ ä¸‹é¢çš„ç®—æ³•ç»†èŠ‚ç« èŠ‚å°†ä¼šä»‹ç»è¯¦ç»†çš„ç®—æ³•ã€‚</description>
    </item>
    
    <item>
      <title>Horizontal Pod Autoscaleræ¼”ç»ƒ</title>
      <link>https://lijun.in/tasks/run-application/horizontal-pod-autoscale-walkthrough/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://lijun.in/tasks/run-application/horizontal-pod-autoscale-walkthrough/</guid>
      <description>Horizontal Pod Autoscaler å¯ä»¥æ ¹æ®CPUåˆ©ç”¨ç‡è‡ªåŠ¨ä¼¸ç¼© replication controllerã€deployment æˆ–è€… replica set ä¸­çš„Podæ•°é‡ ï¼ˆä¹Ÿå¯ä»¥åŸºäºå…¶ä»–åº”ç”¨ç¨‹åºæä¾›çš„åº¦é‡æŒ‡æ ‡ï¼Œç›®å‰è¿™ä¸€åŠŸèƒ½å¤„äº beta ç‰ˆæœ¬ï¼‰ã€‚
æœ¬æ–‡å°†å¼•å¯¼æ‚¨äº†è§£å¦‚ä½•ä¸º php-apache æœåŠ¡å™¨é…ç½®å’Œä½¿ç”¨ Horizontal Pod Autoscalerã€‚ æ›´å¤š Horizontal Pod Autoscaler çš„ä¿¡æ¯è¯·å‚é˜… Horizontal Pod Autoscaler user guideã€‚
. heading &amp;ldquo;prerequisites&amp;rdquo; %}} æœ¬æ–‡ç¤ºä¾‹éœ€è¦ä¸€ä¸ª1.2æˆ–è€…æ›´é«˜ç‰ˆæœ¬çš„å¯è¿è¡Œçš„ Kubernetes é›†ç¾¤ä»¥åŠ kubectlã€‚ metrics-server ä¹Ÿéœ€è¦éƒ¨ç½²åˆ°é›†ç¾¤ä¸­ï¼Œ å®ƒå¯ä»¥é€šè¿‡ resource metrics API å¯¹å¤–æä¾›åº¦é‡æ•°æ®ï¼ŒHorizontal Pod Autoscaler æ­£æ˜¯æ ¹æ®æ­¤ API æ¥è·å–åº¦é‡æ•°æ®ï¼Œéƒ¨ç½²æ–¹æ³•è¯·å‚è€ƒ metrics-server ã€‚ å¦‚æœä½ æ­£åœ¨ä½¿ç”¨GCEï¼ŒæŒ‰ç…§ getting started on GCE guide æ“ä½œï¼Œmetrics-server ä¼šé»˜è®¤å¯åŠ¨ã€‚
å¦‚æœéœ€è¦ä¸º Horizontal Pod Autoscaler æŒ‡å®šå¤šç§èµ„æºåº¦é‡æŒ‡æ ‡ï¼Œæ‚¨çš„ Kubernetes é›†ç¾¤ä»¥åŠ kubectl è‡³å°‘éœ€è¦è¾¾åˆ°1.6ç‰ˆæœ¬ã€‚ æ­¤å¤–ï¼Œå¦‚æœè¦ä½¿ç”¨è‡ªå®šä¹‰åº¦é‡æŒ‡æ ‡ï¼Œæ‚¨çš„Kubernetes é›†ç¾¤è¿˜å¿…é¡»èƒ½å¤Ÿä¸æä¾›è¿™äº›è‡ªå®šä¹‰æŒ‡æ ‡çš„APIæœåŠ¡å™¨é€šä¿¡ã€‚ æœ€åï¼Œå¦‚æœè¦ä½¿ç”¨ä¸ Kubernetes å¯¹è±¡æ— å…³çš„åº¦é‡æŒ‡æ ‡ï¼Œåˆ™ Kubernetes é›†ç¾¤ç‰ˆæœ¬è‡³å°‘éœ€è¦è¾¾åˆ°1.</description>
    </item>
    
    <item>
      <title>æŒ‡å®šåº”ç”¨ç¨‹åºçš„ä¸­æ–­é¢„ç®—ï¼ˆDisruption Budgetï¼‰</title>
      <link>https://lijun.in/tasks/run-application/configure-pdb/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://lijun.in/tasks/run-application/configure-pdb/</guid>
      <description>æœ¬æ–‡å±•ç¤ºäº†å¦‚ä½•é™åˆ¶åº”ç”¨ç¨‹åºçš„å¹¶å‘ä¸­æ–­æ•°é‡ï¼Œåœ¨å…è®¸é›†ç¾¤ç®¡ç†å‘˜ç®¡ç†é›†ç¾¤èŠ‚ç‚¹çš„åŒæ—¶ä¿è¯é«˜å¯ç”¨ã€‚
. heading &amp;ldquo;prerequisites&amp;rdquo; %}}  ç”¨æˆ·æ˜¯ Kubernetes é›†ç¾¤ä¸­æœ‰é«˜å¯ç”¨éœ€æ±‚çš„åº”ç”¨çš„æ‰€æœ‰è€…ã€‚   ç”¨æˆ·åº”äº†è§£å¦‚ä½•éƒ¨ç½² æ— çŠ¶æ€åº”ç”¨ å’Œ/æˆ– æœ‰çŠ¶æ€åº”ç”¨ã€‚   ç”¨æˆ·åº”å½“å·²ç»é˜…è¯»è¿‡å…³äº Pod ä¸­æ–­ çš„æ–‡æ¡£ã€‚   ç”¨æˆ·åº”å½“ä¸é›†ç¾¤æ‰€æœ‰è€…æˆ–æœåŠ¡æä¾›è€…ç¡®è®¤å…¶éµä» Pod ä¸­æ–­é¢„ç®—ï¼ˆPod Disruption Budgetsï¼‰çš„è§„åˆ™ã€‚  ç”¨ PodDisruptionBudget æ¥ä¿æŠ¤åº”ç”¨  ç¡®å®šæƒ³è¦ä½¿ç”¨ PodDisruptionBudget (PDB) æ¥ä¿æŠ¤çš„åº”ç”¨ã€‚ è€ƒè™‘åº”ç”¨å¯¹ä¸­æ–­çš„ååº”ã€‚ ä»¥ YAML æ–‡ä»¶å½¢å¼å®šä¹‰ PDB ã€‚ é€šè¿‡ YAML æ–‡ä»¶åˆ›å»º PDB å¯¹è±¡ã€‚  ç¡®å®šè¦ä¿æŠ¤çš„åº”ç”¨ ç”¨æˆ·æƒ³è¦ä¿æŠ¤é€šè¿‡å†…ç½®çš„ Kubernetes æ§åˆ¶å™¨æŒ‡å®šçš„åº”ç”¨ï¼Œè¿™æ˜¯æœ€å¸¸è§çš„ä½¿ç”¨åœºæ™¯ï¼š
 Deployment ReplicationController ReplicaSet StatefulSet  åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåœ¨æ§åˆ¶å™¨çš„ .spec.selector å­—æ®µä¸­åšè®°å½•ï¼Œå¹¶åœ¨ PDB çš„ .spec.selector å­—æ®µä¸­åŠ å…¥åŒæ ·çš„é€‰æ‹©å™¨ã€‚
ç”¨æˆ·ä¹Ÿå¯ä»¥ç”¨ PDB æ¥ä¿æŠ¤ä¸å—ä¸Šè¿°æ§åˆ¶å™¨æ§åˆ¶çš„ podï¼Œæˆ–ä»»æ„ç»„ï¼ˆarbitrary groupsï¼‰çš„ podï¼Œ ä½†æ˜¯æ­£å¦‚ ä»»æ„æ§åˆ¶å™¨å’Œé€‰æ‹©å™¨ ä¸­æè¿°çš„ï¼Œè¿™é‡Œå­˜åœ¨ä¸€äº›é™åˆ¶ã€‚</description>
    </item>
    
    <item>
      <title>ä½¿ç”¨Deploymentè¿è¡Œä¸€ä¸ªæ— çŠ¶æ€åº”ç”¨</title>
      <link>https://lijun.in/tasks/run-application/run-stateless-application-deployment/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://lijun.in/tasks/run-application/run-stateless-application-deployment/</guid>
      <description>æœ¬æ–‡ä»‹ç»é€šè¿‡Kubernetes Deploymentå¯¹è±¡å¦‚ä½•å»è¿è¡Œä¸€ä¸ªåº”ç”¨.
. heading &amp;ldquo;objectives&amp;rdquo; %}}  åˆ›å»ºä¸€ä¸ªnginx deployment. ä½¿ç”¨kubectlåˆ—ä¸¾å…³äºdeploymentä¿¡æ¯. æ›´æ–°deployment.  . heading &amp;ldquo;prerequisites&amp;rdquo; %}} . include &amp;ldquo;task-tutorial-prereqs.md&amp;rdquo; &amp;gt;}} . version-check &amp;gt;}}
åˆ›å»ºå’Œæ¢ç©¶ä¸€ä¸ªnginx deployment ä½ å¯ä»¥é€šè¿‡åˆ›å»ºä¸€ä¸ªKubernetes Deploymentå¯¹è±¡æ¥è¿è¡Œä¸€ä¸ªåº”ç”¨, å¯ä»¥åœ¨ä¸€ä¸ªYAMLæ–‡ä»¶ä¸­æè¿°Deployment. ä¾‹å¦‚, ä¸‹é¢è¿™ä¸ªYAMLæ–‡ä»¶æè¿°äº†ä¸€ä¸ªè¿è¡Œnginx:1.7.9 Dockeré•œåƒçš„Deployment:
. codenew file=&amp;quot;application/deployment.yaml&amp;rdquo; &amp;gt;}}
  é€šè¿‡YAMLæ–‡ä»¶åˆ›å»ºä¸€ä¸ªDeployment:
 kubectl apply -f https://k8s.io/examples/application/deployment.yaml    å±•ç¤ºDeploymentç›¸å…³ä¿¡æ¯:
kubectl describe deployment nginx-deployment user@computer:~/website$ kubectl describe deployment nginx-deployment Name: nginx-deployment Namespace: default CreationTimestamp: Tue, 30 Aug 2016 18:11:37 -0700 Labels: app=nginx Annotations: deployment.</description>
    </item>
    
    <item>
      <title>å¼¹ç¼©StatefulSet</title>
      <link>https://lijun.in/tasks/run-application/scale-stateful-set/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://lijun.in/tasks/run-application/scale-stateful-set/</guid>
      <description>æœ¬æ–‡ä»‹ç»å¦‚ä½•å¼¹ç¼©StatefulSet.
. heading &amp;ldquo;prerequisites&amp;rdquo; %}}  StatefulSetsä»…é€‚ç”¨äºKubernetes1.5åŠä»¥ä¸Šç‰ˆæœ¬. ä¸æ˜¯æ‰€æœ‰Statefulåº”ç”¨éƒ½é€‚åˆå¼¹ç¼©. åœ¨å¼¹ç¼©å‰æ‚¨çš„åº”ç”¨å‰. æ‚¨å¿…é¡»å……åˆ†äº†è§£æ‚¨çš„åº”ç”¨, ä¸é€‚å½“çš„å¼¹ç¼©StatefulSetæˆ–è®¸ä¼šé€ æˆåº”ç”¨è‡ªèº«åŠŸèƒ½çš„ä¸ç¨³å®š. ä»…å½“æ‚¨ç¡®å®šè¯¥Statefulåº”ç”¨çš„é›†ç¾¤æ˜¯å®Œå…¨å¥åº·æ‰å¯æ‰§è¡Œå¼¹ç¼©æ“ä½œ.  ä½¿ç”¨ kubectl å¼¹ç¼©StatefulSets å¼¹ç¼©è¯·ç¡®è®¤ kubectl å·²ç»å‡çº§åˆ°Kubernetes1.5åŠä»¥ä¸Šç‰ˆæœ¬. å¦‚æœä¸ç¡®å®š, æ‰§è¡Œ kubectl version å‘½ä»¤å¹¶æ£€æŸ¥ä½¿ç”¨çš„ Client Version.
kubectl å¼¹ç¼© é¦–å…ˆ, æ‰¾åˆ°æ‚¨æƒ³è¦å¼¹ç¼©çš„StatefulSet. è®°ä½, æ‚¨éœ€å…ˆæ¸…æ¥šæ˜¯å¦èƒ½å¼¹ç¼©è¯¥åº”ç”¨.
kubectl get statefulsets &amp;lt;stateful-set-name&amp;gt; æ”¹å˜StatefulSetå‰¯æœ¬æ•°é‡:
kubectl scale statefulsets &amp;lt;stateful-set-name&amp;gt; --replicas=&amp;lt;new-replicas&amp;gt; å¯ä½¿ç”¨å…¶ä»–å‘½ä»¤: kubectl apply / kubectl edit / kubectl patch å¦å¤–, æ‚¨å¯ä»¥ in-place updates StatefulSets.
å¦‚æœæ‚¨çš„StatefulSetå¼€å§‹ç”± kubectl apply æˆ– kubectl create --save-config åˆ›å»º,æ›´æ–°StatefulSet manifestsä¸­çš„ .spec.replicas, ç„¶åæ‰§è¡Œå‘½ä»¤ kubectl apply:
kubectl apply -f &amp;lt;stateful-set-file-updated&amp;gt; é™¤æ­¤ä¹‹å¤–, å¯ä»¥é€šè¿‡å‘½ä»¤ kubectl edit ç¼–è¾‘è¯¥å­—æ®µ:</description>
    </item>
    
    <item>
      <title>è¿è¡Œä¸€ä¸ªå•å®ä¾‹æœ‰çŠ¶æ€åº”ç”¨</title>
      <link>https://lijun.in/tasks/run-application/run-single-instance-stateful-application/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://lijun.in/tasks/run-application/run-single-instance-stateful-application/</guid>
      <description>æœ¬æ–‡ä»‹ç»åœ¨ Kubernetes ä¸­ä½¿ç”¨ PersistentVolume å’Œ Deployment å¦‚ä½•è¿è¡Œä¸€ä¸ªå•å®ä¾‹æœ‰çŠ¶æ€åº”ç”¨. è¯¥åº”ç”¨æ˜¯ MySQL.
. heading &amp;ldquo;objectives&amp;rdquo; %}}  åœ¨ç¯å¢ƒä¸­é€šè¿‡ç£ç›˜åˆ›å»ºä¸€ä¸ªPersistentVolume. åˆ›å»ºä¸€ä¸ªMySQL Deployment. åœ¨é›†ç¾¤å†…ä»¥ä¸€ä¸ªå·²çŸ¥çš„ DNS åå°† MySQL æš´éœ²ç»™å…¶ä»– pods.  . heading &amp;ldquo;prerequisites&amp;rdquo; %}}   . include &amp;ldquo;task-tutorial-prereqs.md&amp;rdquo; &amp;gt;}} . version-check &amp;gt;}}
  . include &amp;ldquo;default-storage-class-prereqs.md&amp;rdquo; &amp;gt;}}
  éƒ¨ç½²MySQL æ³¨æ„: åœ¨é…ç½®çš„ yaml æ–‡ä»¶ä¸­å®šä¹‰å¯†ç çš„åšæ³•æ˜¯ä¸å®‰å…¨çš„. å…·ä½“å®‰å…¨è§£å†³æ–¹æ¡ˆè¯·å‚è€ƒ Kubernetes Secrets.
. codenew file=&amp;quot;application/mysql/mysql-deployment.yaml&amp;rdquo; &amp;gt;}} . codenew file=&amp;quot;application/mysql/mysql-pv.yaml&amp;rdquo; &amp;gt;}}
  éƒ¨ç½² YAML æ–‡ä»¶ä¸­å®šä¹‰çš„ PV å’Œ PVCï¼š
 kubectl apply -f https://k8s.</description>
    </item>
    
  </channel>
</rss>